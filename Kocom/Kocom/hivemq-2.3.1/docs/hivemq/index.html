<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.3">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HiveMQ 2.3.1 - User Guide</title>
<link rel="stylesheet" href="styles/iconic_hivemq.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.1.0/css/font-awesome.min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
</head>
<body class="article">
<div id="header">
<h1>HiveMQ 2.3.1 - User Guide</h1>
<span id="author">Dominik Obermaier</span><br>
<span id="revnumber">version 1-DRAFT,</span>
<span id="revdate">05-31-2013, User Guide for HiveMQ 2.3.1</span>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ol type="none" class="sectlevel1">
<li><a href="#hivemqdocs_introduction">Introduction</a></li>
<li><a href="#hivemqdocs_pre_installation_requirements">Pre Installation Requirements</a></li>
<li><a href="#installation">Installation</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#hivemqdocs_general_installation_information">General installation information</a></li>
<li><a href="#hivemqdocs_installation_for_specific_operating_systems">Installation for specific Operating Systems</a></li>
<li><a href="#starting-hivemq-chapter">Starting HiveMQ</a></li>
<li><a href="#hivemqdocs_testing_the_installation">Testing the installation</a></li>
<li><a href="#hivemqdocs_using_ports_between_1_and_1024_on_linux_machines">Using ports between 1 and 1024 on Linux machines</a></li>
<li><a href="#hivemqdocs_troubleshooting">Troubleshooting</a></li>
</ol>
</li>
<li><a href="#configuration-chapter">Configuration</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#hivemqdocs_configuration_files">Configuration Files</a></li>
<li><a href="#hivemqdocs_configuration_options">Configuration Options</a></li>
<li><a href="#hivemqdocs_binding_hivemq_to_different_interfaces">Binding HiveMQ to different interfaces</a></li>
</ol>
</li>
<li><a href="#security-chapter">Security</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#hivemqdocs_ssl_tls">SSL/TLS</a></li>
<li><a href="#hivemqdocs_communication_protocol">Communication Protocol</a></li>
<li><a href="#hybrid-mode-chapter">Hybrid Mode</a></li>
<li><a href="#hivemqdocs_secure_websockets">Secure Websockets</a></li>
</ol>
</li>
<li><a href="#authentication-and-permissions-chapter">Authentication, Authorization &amp; Permissions</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#x509-client-auth-chapter">X.509 Client Certificate Authentication</a></li>
<li><a href="#username-password-auth-chapter">Username and Password Authentication and Authorization</a></li>
<li><a href="#hivemqdocs_client_id_authentication_and_authorization">Client ID Authentication and Authorization</a></li>
</ol>
</li>
<li><a href="#hivemqdocs_logging">Logging</a></li>
<li><a href="#hivemqdocs_monitoring">Monitoring</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#jmx-monitoring-chapter">JMX</a></li>
<li><a href="#monitoring-graphite-chapter">Graphite</a></li>
<li><a href="#hivemqdocs__sys_topic">$SYS Topic</a></li>
<li><a href="#hivemqdocs_resource_consumption_logging">Resource Consumption Logging</a></li>
<li><a href="#plugin-monitoring-chapter">Monitoring of Plugins</a></li>
</ol>
</li>
<li><a href="#cluster-chapter">Clustering</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#hivemqdocs_prerequisites">Prerequisites</a></li>
<li><a href="#hivemqdocs_enabling_cluster_support">Enabling cluster support</a></li>
<li><a href="#cluster-udp">Elastic Cluster with UDP Multicast</a></li>
<li><a href="#cluster-tcp">Fixed size cluster with TCP</a></li>
<li><a href="#cluster-aws">Elastic Cluster with AWS S3 auto discovery</a></li>
</ol>
</li>
<li><a href="#bridges-chapter">Bridges</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#bridge-protocol">The MQTT Bridge protocol</a></li>
<li><a href="#hivemqdocs_bridge_types">Bridge Types</a></li>
<li><a href="#hivemqdocs_configuration">Configuration</a></li>
<li><a href="#bridges-remapping-of-topics">Remapping of topics</a></li>
<li><a href="#bridge-manager-service">HiveMQ Bridge Manager Service</a></li>
<li><a href="#bridges-interoperability">Interoperability</a></li>
</ol>
</li>
<li><a href="#plugin-chapter">Plugins</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#hivemqdocs_installing_plugins">Installing Plugins</a></li>
<li><a href="#hivemqdocs_configuring_plugins">Configuring Plugins</a></li>
<li><a href="#hivemqdocs_developing_plugins">Developing Plugins</a></li>
</ol>
</li>
<li><a href="#hivemqdocs_throttling_amp_limits">Throttling &amp; Limits</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#hivemqdocs_limiting_connections">Limiting connections</a></li>
<li><a href="#hivemqdocs_throttling_bandwidth">Throttling bandwidth</a></li>
<li><a href="#hivemqdocs_limiting_mqtt_message_sizes">Limiting MQTT message sizes</a></li>
</ol>
</li>
<li><a href="#websockets-chapter">Websockets</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#supported-mqtt-js-libraries-chapter">Supported MQTT Javascript Libraries</a></li>
<li><a href="#enabling-websockets-chapter">Enabling Websockets</a></li>
<li><a href="#secure-websockets-configuration-chapter">Enabling secure Websockets</a></li>
<li><a href="#hivemqdocs_gotchas">Gotchas</a></li>
</ol>
</li>
<li><a href="#hivemqdocs_running_hivemq_in_the_cloud">Running HiveMQ in the Cloud</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#hivemqdocs_running_hivemq_on_amazon_webservices_aws">Running HiveMQ on Amazon Webservices (AWS)</a></li>
<li><a href="#hivemqdocs_running_hivemq_on_microsoft_windows_azure">Running HiveMQ on Microsoft Windows Azure</a></li>
</ol>
</li>
<li><a href="#hivemqdocs_non_standard_mqtt_behaviour">Non-standard MQTT Behaviour</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#hivemqdocs_last_will_and_testament">Last Will and Testament</a></li>
</ol>
</li>
<li><a href="#appendix-chapter">Appendix</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#hivemqdocs_howto_configure_ssl_with_hivemq_and_keytool">Appendix A: HowTo configure SSL with HiveMQ and Keytool</a></li>
<li><a href="#hivemqdocs_howto_configure_ssl_with_hivemq_and_portecle">Appendix B: HowTo configure SSL with HiveMQ and Portecle</a></li>
</ol>
</li>
</ol>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(["trackPageView"]);
  _paq.push(["enableLinkTracking"]);

  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://piwik.baycix.de/";
    _paq.push(["setTrackerUrl", u+"piwik.php"]);
    _paq.push(["setSiteId", "5"]);
    var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
    g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->
</div>
</div>
<div class="sect1">
<h2 id="hivemqdocs_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>HiveMQ is a <a href="http://www.mqtt.org">MQTT broker</a> tailored specifically for enterprises which find themself in the emerging age of Machine-to-Machine communication (M2M) and the Internet of Things. It was built from the ground up with maximum scalability and enterprise-ready security concepts in mind. HiveMQ implements the Message Queue Telemetry Transport protocol, the de-facto M2M messaging standard, and through its 100% compliance to the specification, it is leading when it comes to professional adoption of all possibilities of the Internet of Things for companies.</p>
</div>

</div>
</div>
<div class="sect1">
<h2 id="hivemqdocs_pre_installation_requirements">Pre Installation Requirements</h2>
<div class="sectionbody">
<div class="ulist">
<div class="title">Hardware</div>
<ul>
<li>
<p>At least 128MB of RAM. 512MB or more is recommended</p>
</li>
<li>
<p>20MB of free disk space for HiveMQ itself. At least 50MB for persistence features are recommended.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Operating Systems</div>
<ul>
<li>
<p>Windows, Mac OS X or Linux. It is recommended to use a Linux distribution for production use.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Environment</div>
<ul>
<li>
<p>OpenJDK 1.7 or newer must be installed.</p>
</li>
</ul>
</div>

</div>
</div>
<div class="sect1">
<h2 id="installation">Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide explains the default installation, if you want to try and review HiveMQ you can follow the getting started guide instead: <a href="http://www.hivemq.com/documentations/getting-started/">http://www.hivemq.com/documentations/getting-started/</a></p>
</div>
<div class="sect2">
<h3 id="hivemqdocs_general_installation_information">General installation information</h3>
<div class="paragraph">
<p>HiveMQ comes as a zip file which contains the executables, init scripts and sample configurations.</p>
</div>
<div class="paragraph">
<p>The zip contains the following directories:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:28%;">
<col style="width:71%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Folder name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The folder with start scripts and binary files</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>conf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The folder with the <a href="#configuration-chapter">configurations</a></em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>data</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Persistent client data and cluster data are located here.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plugins</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The folder where plugins reside</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>license</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The folder where the hivemq.lic license file resides.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>All log files can be found here</em></p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="hivemqdocs_installation_for_specific_operating_systems">Installation for specific Operating Systems</h3>
<div class="paragraph">
<p>This procedure shows how to install the most recent HiveMQ version. To install older HiveMQ versions please visit <a href="http://www.hivemq.com/downloads/">http://www.hivemq.com/downloads/</a></p>
</div>
<div class="sect3">
<h4 id="hivemqdocs_installation_instructions_for_unix_based_systems_linux_bsd_macos_x_unix">Installation instructions for Unix based systems (Linux,BSD,MacOS X,Unix)</h4>
<div class="paragraph">
<p>The default installation directory is <code>/opt/hivemq</code> and the default user to run HiveMQ is named <code>hivemq</code>. If you need to install HiveMQ to a custom directory or run it under a custom user please be aware of changing the <code>$HIVEMQ_DIRECTORY</code> and/or the <code>HIVEMQ_USER</code> in the <code>$HIVEMQ_DIRECTORY/bin/start.sh</code> script.</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Login as root</p>
<div class="paragraph">
<p>Some of the following commands need root privileges, please login as root or use sudo to execute the commands.</p>
</div>

</li>
<li>
<p>Change directory to where you want to download and install HiveMQ. By default we prefer <code>/opt</code></p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>cd /opt</code></pre>
</div>
</div>

</li>
<li>
<p>Download latest HiveMQ version from the website</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>wget --content-disposition http://www.hivemq.com/downloads/releases/latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>curl -O -L http://www.hivemq.com/downloads/releases/latest</code></pre>
</div>
</div>

</li>
<li>
<p>Extract the files</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>unzip hivemq-&lt;version&gt;.zip</code></pre>
</div>
</div>

</li>
<li>
<p>Create hivemq symlink</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>ln -s /opt/hivemq-&lt;version&gt; /opt/hivemq</code></pre>
</div>
</div>

</li>
<li>
<p>Create HiveMQ user</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>useradd -d /opt/hivemq hivemq</code></pre>
</div>
</div>

</li>
<li>
<p>Make scripts executeable and change owner to hivemq user</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>chown -R hivemq:hivemq /opt/hivemq-&lt;version&gt;
chown -R hivemq:hivemq /opt/hivemq
cd /opt/hivemq
chmod +x ./bin/run.sh</code></pre>
</div>
</div>

</li>
<li>
<p>Adjust the configuration properties to your needs.</p>
<div class="paragraph">
<p>See chapter <a href="#configuration-chapter">Configuration</a> for detailed instructions how to configure HiveMQ.</p>
</div>
<div class="paragraph">
<p>If you just want to try HiveMQ you can skip this part now and proceed with <a href="#starting-hivemq-chapter">Starting HiveMQ</a>.</p>
</div>

</li>
<li>
<p>Install the init script (optional)</p>
<div class="paragraph">
<p>For Debian-based linux like Debian, Ubuntu, Raspbian</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>cp /opt/hivemq/bin/init-script/hivemq-debian /etc/init.d/hivemq
chmod +x /etc/init.d/hivemq</code></pre>
</div>
</div>
<div class="paragraph">
<p>For all other unix systems</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>cp /opt/hivemq/bin/init-script/hivemq /etc/init.d/hivemq
chmod +x /etc/init.d/hivemq</code></pre>
</div>
</div>

</li>
<li>
<p>Modify /etc/init.d/hivemq (optional)</p>
<div class="paragraph">
<p>Set the <code>HIVEMQ_HOME</code> and the <code>HIVEMQ_USER</code> variable to the correct vaules for your system.</p>
</div>
<div class="paragraph">
<p>By default this would be:</p>
</div>
<div class="paragraph">
<p><code>HIVEMQ_HOME=/opt/hivemq</code></p>
</div>
<div class="paragraph">
<p><code>HIVEMQ_USER=hivemq</code></p>
</div>
<div class="paragraph">
<p>If you installed HiveMQ to a different directory than <code>/opt/hivemq</code> please point the <code>HIVEMQ_HOME</code> in your init script to the correct directory. Otherwise the daemon will not start correctly.</p>
</div>

</li>
<li>
<p>Start HiveMQ on boot (optional)</p>
<div class="paragraph">
<p>For Debian-based linux like Debian, Ubuntu, Raspbian</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>update-rc.d hivemq defaults</code></pre>
</div>
</div>
<div class="paragraph">
<p>Debian &gt; 6.0</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>insserv hivemq</code></pre>
</div>
</div>
<div class="paragraph">
<p>CentOS or RHEL</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>chkconfig hivemq on</code></pre>
</div>
</div>

</li>
</ol>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_installation_instructions_for_windows_based_systems">Installation instructions for Windows based systems</h4>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Download latest HiveMQ version from here: <a href="http://www.hivemq.com/downloads/releases/latest">http://www.hivemq.com/downloads/releases/latest</a></p>
</li>
<li>
<p>Extract the file <code>hivemq.zip</code> to <code>C:\hivemq</code> using your favorite Zip util.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="hivemqdocs_installation_as_windows_service">Installation as Windows Service</h5>
<div class="paragraph">
<p>In order to install HiveMQ as a Windows service conveniently, please download the <strong>Windows Service Installer</strong> here: <a href="http://hivemq.com/additional-software/hivemq-windows-service.zip">http://hivemq.com/additional-software/hivemq-windows-service.zip</a></p>
</div>
<div class="paragraph">
<p>The steps to install HiveMQ as a Windows Service are:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Download the <code>hivemq-windows-service.zip</code> file here: <a href="http://hivemq.com/additional-software/hivemq-windows-service.zip">http://hivemq.com/additional-software/hivemq-windows-service.zip</a></p>
</li>
<li>
<p>Unzip the <code>hivemq-windows-service.zip</code> file.</p>
</li>
<li>
<p>Copy the <code>windows-service</code> folder to your HiveMQ home folder.</p>
</li>
<li>
<p>Open the <code>windows-service</code> folder.</p>
</li>
<li>
<p>Double click the <code>installService.bat</code> file.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">

Make sure you have the permission to install a service.
Therefore it might be necessary to right click the <code>installService.bat</code> and select <code>Run as administrator</code>.
</td>
</tr>
</table>
</div>

</div>

</div>

</div>
<div class="sect2">
<h3 id="starting-hivemq-chapter">Starting HiveMQ</h3>
<div class="paragraph">
<p>The following instructions show how to start HiveMQ</p>
</div>
<div class="sect3">
<h4 id="hivemqdocs_starting_hivemq_on_unix_based_systems_linux_bsd_mac_os_x_unix">Starting HiveMQ on Unix based systems (Linux,BSD,Mac OS X,Unix)</h4>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Change directory to HiveMQ directory</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>cd /opt/hivemq</code></pre>
</div>
</div>

</li>
<li>
<p>Execute startup script</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>./bin/run.sh</code></pre>
</div>
</div>

</li>
<li>
<p>(optional) Start daemon</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>/etc/init.d/hivemq start</code></pre>
</div>
</div>

</li>
</ol>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_starting_hivemq_on_windows_based_systems">Starting HiveMQ on Windows based systems</h4>
<div class="paragraph">
<p>Double click on the <code>run.bat</code> file.</p>
</div>

</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_testing_the_installation">Testing the installation</h3>
<div class="paragraph">
<p>The following instructions show how to verify that HiveMQ is up and running</p>
</div>
<div class="sect3">
<h4 id="hivemqdocs_verifying_hivemq_is_running_on_a_unix_based_systems_linux_bsd_mac_os_x_unix">Verifying HiveMQ is running on a Unix based systems (Linux,BSD,Mac OS X,Unix)</h4>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Check if HiveMQ is listening to the default port for MQTT</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>netstat -an|grep 1883</code></pre>
</div>
</div>

</li>
</ol>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_verifying_hivemq_is_running_on_a_windows_based_systems">Verifying HiveMQ is running on a Windows based systems</h4>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Check if HiveMQ is listening to the default port for MQTT. Open <code>cmd.exe</code> and run:</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>netstat -an|find "1883"</code></pre>
</div>
</div>

</li>
</ol>
</div>

</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_using_ports_between_1_and_1024_on_linux_machines">Using ports between 1 and 1024 on Linux machines</h3>
<div class="paragraph">
<p>HiveMQ uses port <em>1883</em> (for standard MQTT) and <em>8883</em> (for MQTT + TLS) by default. Sometimes it may be desirable to use ports between <em>0</em> and <em>1024</em>, which are reserved for root users.</p>
</div>
<div class="paragraph">
<p>A common solution for running HiveMQ on ports below port 1024 is using <strong>authbind</strong>.</p>
</div>
<div class="sect3">
<h4 id="hivemqdocs_installing_authbind">Installing authbind</h4>
<div class="listingblock">
<div class="title">Install authbind on Debian based systems</div>
<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>sudo apt-get install authbind</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Install authbind on RHEL/CentOS</div>
<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code># Unfortunately authbind is not available in the standard RHEL repositories, so we have to install it manually
yum install -y gcc-c++
wget http://ftp.debian.org/debian/pool/main/a/authbind/authbind_2.1.1.tar.gz -O authbind.tar.gz
tar zxf authbind.tar.gz
cd authbind-2.1.1
make
make install</code></pre>
</div>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_configuring_authbind">Configuring authbind</h4>
<div class="paragraph">
<p>In this example we&#8217;re assuming we want to give HiveMQ the privilege to run on port <em>80</em>.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>touch /etc/authbind/byport/80
chmod 500 /etc/authbind/byport/80
chown hivemq:hivemq /etc/authbind/byport/80</code></pre>
</div>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_modifying_the_init_script">Modifying the init script</h4>
<div class="paragraph">
<p>Now we have to modify the init script to use authbind.</p>
</div>
<div class="listingblock">
<div class="title">CentOS based Systems</div>
<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>sed -i 's|su $HIVEMQ_USER -c "$HIVEMQ_HOME/bin/run.sh &gt;/dev/null 2&gt;\&amp;1 \&amp;"|su $HIVEMQ_USER -c "exec /usr/local/bin/authbind --deep $HIVEMQ_HOME/bin/run.sh &gt;/dev/null 2&gt;\&amp;1 \&amp;"|g' /etc/init.d/hivemq</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Debian based Systems</div>
<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>sed -i 's|su $HIVEMQ_USER -c "$HIVEMQ_HOME/bin/run.sh &gt;/dev/null 2&gt;\&amp;1 \&amp;"|su $HIVEMQ_USER -c "exec /usr/bin/authbind --deep $HIVEMQ_HOME/bin/run.sh &gt;/dev/null 2&gt;\&amp;1 \&amp;"|g' /etc/init.d/hivemq</code></pre>
</div>
</div>

</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_troubleshooting">Troubleshooting</h3>
<div class="sect3">
<h4 id="hivemqdocs_port_is_already_in_use">Port is already in use</h4>
<div class="paragraph">
<p>If you are seeing a message like the one below in your logs before HiveMQ shutdown, there is probably already an application running on the port HiveMQ wants to use.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>2014-09-04 22:51:53,468 ERROR - Could not bind to all interfaces and port 1883, because it is already in use. Stopping HiveMQ.</pre>
</div>
</div>
<div class="paragraph">
<p>To find out which application is running on this port, use the following command:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>lsof -iTCP:1883</code></pre>
</div>
</div>
<div class="paragraph">
<p>To solve the issue, you have basically two options:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Exit the application already using that port.</p>
</li>
<li>
<p>Start HiveMQ on another port. You can learn more about starting HiveMQ on another port in the <a href="#configuration-chapter">Configuration Chapter</a>.</p>
</li>
</ol>
</div>

</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="configuration-chapter">Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="hivemqdocs_configuration_files">Configuration Files</h3>
<div class="paragraph">
<p>HiveMQ is configured with sensible default settings. Therefore most users will find it sufficient to use the default values to get started.
All configuration files are located in the <code>conf</code> folder of the HiveMQ directory. In the following the different configuration files are explained:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 1. HiveMQ configuration files</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property file name</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configuration.properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Static broker configuration properties which are needed for HiveMQ to start.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application.properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic application specific properties which can be edited at runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cluster-*.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configurations for the cluster transport and protocol communication (<strong>only needed for <a href="#cluster-chapter">clustering</a></strong>). If cluster is enabled, HiveMQ expects 5 of these files (<code>cluster-client.xml</code>, <code>cluster-mq.xml</code>, <code>cluster-pub.xml</code>, <code>cluster-retain.xml</code>, <code>cluster-sub.xml</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bridges.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configurations for MQTT broker bridges (<strong>only needed for <a href="#bridges-chapter">bridges</a></strong>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you want all properties to be static, it is possible to copy all settings from the <code>application.properties</code> file to the <code>configuration.properties</code> file.
HiveMQ will pick these values up at startup time and these values cannot be modified at runtime anymore.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Configuration files</div>
The <code>configuration.properties</code> file is read only once during the HiveMQ startup and you have to restart HiveMQ before any changes made during runtime are coming into effect.
The properties in the <code>application.properties</code> are updated automatically <em>every minute</em>.
</td>
</tr>
</table>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_configuration_options">Configuration Options</h3>
<div class="paragraph">
<p>The following tables list the available configuration options for HiveMQ. When a property is not defined in one of the configuration files the default value will be used.</p>
</div>
<div class="sect3">
<h4 id="hivemqdocs_application_properties">application.properties</h4>
<div class="paragraph">
<p>The properties defined here <em>can be changed at runtime</em>. HiveMQ reloads this configuration file <em>once a minute</em>.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 2. Dynamic properties</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plugin.performanceMonitoring</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Enable to monitor the performance of plugins. When enabled this will result in a significant performance loss.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.outgoingLimit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Maximum kb/s for outgoing traffic. Use 0 if you don&#8217;t want to throttle outgoing traffic</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.maxConnections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Maximum allowed concurrent connections. Use -1 for unlimited connections</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.maxMessageSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">268435456</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Maximum message size. The MQTT default for a message is 256MB. If clients must publish messages which are smaller, a saner message size limit should be configured.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.ingoingLimit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Maximum kb/s for ingoing traffic. Use 0 if you don&#8217;t want to throttle ingoing traffic</em></p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="hivemqdocs_configuration_properties">configuration.properties</h4>
<div class="paragraph">
<p>The properties defined here are applied once during the startup of HiveMQ and <em>cannot be changed at runtime</em>.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 3. Static properties</caption>
<colgroup>
<col style="width:33%;">
<col style="width:11%;">
<col style="width:55%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.ipAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The IP address on which HiveMQ will be bound to</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1883</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The port on which HiveMQ will listen</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.retryInterval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Time in seconds to wait before resending an outgoing QoS=1 or QoS=2 message</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.maxClientIdLength</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">65535</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The maximum length of client ID. The MQTT v3.1 spec defines a limit of 23. Since there is no real reason for that artificial limit, HiveMQ sets the default limit to 65535</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.checkForUpdates</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>If enabled, HiveMQ checks if a new HiveMQ version is available once a day</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>graphite.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Enable the monitoring with Graphite</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>graphite.interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The interval for publishing metrics to Graphite in seconds. Too low intervals could results in possible performance losses.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>graphite.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">localhost:2003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The Graphite URL. Must be in the format "hostname:port"</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>graphite.metricPrefix</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A prefix for every metric which is sent to the Graphite instance. Useful for distinguishing between different HiveMQ servers or when using a hosted Graphite service to prefix the API Key</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keystore.location</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The location of the servers key store. It is expected relatively to the HiveMQ home folder or as absolute path.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keystore.password</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The password for the keystore of the server. Defaults to no password</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>measureResourceConsumption.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Enables the resource consumption logging</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>measureResourceConsumption.interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Time in seconds between logging of the resource consumption</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>messages.maxInflight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The maximum number of QoS 1 or 2 messages that can be in the process of being transmitted simultaneously. This includes messages currently going through handshakes and messages that are being retried. Set to 0 for no maximum. If set to 1, this will guarantee in-order delivery of messages for QoS1 und QoS2.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>messages.maxQueued</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The maximum number of queued (QoS 1 + 2) messages per client. When messages can&#8217;t be processed because the maximum numbers of in-flight messages are processed right now, the messages will be queued for later processing. If the number of maxQueued messages is reached, all new incoming messages to deliver will be discarded for the client. Set to 0 if you don&#8217;t want messages to get discarded.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mqtt.lwt.onEveryDisconnect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>If this feature is enabled, HiveMQ will send Last-Will-And-Testament messages on all client disconnects, even graceful disconnects with a prior DISCONNECT message. <strong>This is a non-standard MQTT behaviour, only enable it if you really want this behaviour</strong>.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plugin.LowLevelCallbacksEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Low level callbacks are callbacks which include all existing MQTT command messages, like PubRec, PubRel, etc. If your plugin needs to react to each individual MQTT command message, set this to true and all callbacks are available. In most cases the low level callbacks are not needed, only activate them if you really use them, otherwise this is influencing the performance.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.applicationClientAuthentication</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Enables or disables SSL client certificate authentication on the application layer. This does NOT affect transport client authentication. Essentially this enables HiveMQ plugins to provide permissions for users with specific client certificates.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.clientAuthenticationMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Sets the client authentication mode. Allowed values are: none, optional and required</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Enables or disables SSL support</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.handshakeTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The timeout for a SSL handshake. All clients which need longer for a handshake than the specified timeout will be disconnected. If not specified, no timeout is set.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.hybridMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>If the hybrid mode is enabled and SSL is activated, SSL and standard TCP connections are supported simultaneously</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.ipAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The IP address MQTT over TLS/SSL will be bound to.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8883</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The port where HiveMQ will expect SSL encrypted connections</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The cryptographic protocol which should be used for the secure communication between HiveMQ and its clients. Defaults to TLS.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>statistics.callbackInterval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Interval in seconds for the statistics callback. Used for the callback of plugins which are interested in HiveMQ statistics.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>statistics.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>If statistics are enabled or not. If you disable statistics, the $SYS topic is also disabled.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>statistics.updateInterval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Interval in seconds for updating statistics internally. Too low intervals could result in performance loss. It is recommended, that the statistics_update_interval is smaller than the sys_interval and the statistics_callback_interval</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sys.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>If the $SYS tree should be available or not. Use true if you want to enable statistics</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sys.interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Time in seconds between publishes of the $SYS tree</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>truststore.location</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The location of the trust store. It is expected relatively to the HiveMQ home folder or as absolute path.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>truststore.password</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The password for the truststore. Defaults to no password.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>This property enables websocket support for HiveMQ when set to <strong>true</strong></em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.ipAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The IP address MQTT over websockets will be bound to</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The port used for websockets. Defaults to <strong>8000</strong>.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.subProtocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mqttv3.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The subprotocol used for websockets. When using Paho.js this should be mqttv3.1</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/mqtt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The path of the websocket</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.allowExtensions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Defines if websocket extensions are allowed.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.maxHttpChunkContentLength</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">65536</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The maximum content length of a chunked HTTP request</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.secure.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>When set to <strong>true</strong>, enables secure websockets for HiveMQ</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.secure.ipAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The IP address on which secure websockets will be bound to</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.secure.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The port for the secure websockets.</em></p></td>
</tr>
</tbody>
</table>

</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_binding_hivemq_to_different_interfaces">Binding HiveMQ to different interfaces</h3>
<div class="paragraph">
<p>HiveMQ can be bound to different network interfaces. You can for example bind MQTT over standard TCP to one interface and MQTT over TLS to another interface. The relevant properties for that feature are listed in the following table.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 4. Relevant properties binding HiveMQ to different interfaces</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.ipAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The IP address on which HiveMQ will be bound</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.ipAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The IP address MQTT over TLS/SSL will be bound to</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.ipAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The IP address MQTT over websockets will be bound to</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.secure.ipAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The IP address on which secure websockets will be bound to</em></p></td>
</tr>
</tbody>
</table>

</div>

</div>
</div>
<div class="sect1">
<h2 id="security-chapter">Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From the ground up, HiveMQ was designed with maximum security in mind. It is mission critical for many M2M scenarios to enable secure, encrypted end-to-end communication and advanced authentication and authorization features. HiveMQ gives you the flexibility to enable specific security features for your concrete use. The following shows how to enable and configure these security features.</p>
</div>
<div class="sect2">
<h3 id="hivemqdocs_ssl_tls">SSL/TLS</h3>
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">Transport Layer Security (TLS)</a> is a cryptographic protocol which allows a secure and encrypted communication at transport layer between a client application and a server. If TLS is enabled in HiveMQ, every client connection is encrypted and secured by TLS. It is also possible to use X.509 certificate client authentication, please see the chapter <a href="#x509-client-auth-chapter">X.509 Certificate Authentication</a> for more details.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Hybrid Mode</div>
You can configure HiveMQ to use a hybrid mode which means that HiveMQ can handle encrypted and unencrypted connections simultaneously. See the <a href="#hybrid-mode-chapter">Hybrid Mode chapter</a> for more details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For usage scenarios where sensitive information is published via MQTT it is <em>strongly</em> recommended to enable TLS. When configured correctly it is <strong>very very hard</strong> <span class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</span> for an attacker to break the encryption and read the packets on the wire. Since TLS is a proofen technology and the whole transport is encrypted, TLS could be a better choice than a hand-rolled payload encryption when security is more important for your scenario than package overhead. See <a href="#encryption-tls-vs-application-infobox">the Infobox</a> for more details.</p>
</div>
<div class="paragraph">
<p>As in most cases, added security comes with some disadvantages. The most important disadvantage is, that SSL/TLS comes with a signifcant increase in used bandwidth. While we are talking of tens of bytes here, it can make a huge difference in scenarios where small bandwidth usage is key. Please note that the SSL handshake (which takes place when a connection is established) comes with an additonal overhead in terms of bandwidth and CPU. This is very important to consider when you have to deal with many unreliable connections which could easily drop.</p>
</div>
<div id="encryption-tls-vs-application-infobox" class="sidebarblock">
<div class="content">
<div class="title">Encryption at Transport Layer vs Encryption at Application Layer</div>
<div class="paragraph">
<p><em>Encryption at transport layer</em> <span class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</span> has the advantage that the whole connection is encrypted, including all MQTT messages sent from the client to the server and from the server to the client. This ensures that nobody but the client which is connected to HiveMQ can read any message of the communication. Since the payload of the MQTT message remain unencrypted raw bytes in this case, fully interoperability with other MQTT clients (even if they do not use TLS) is ensured. <strong>All MQTT messages (not only PUBLISHes) are secured with this technique.</strong></p>
</div>
<div class="paragraph">
<p><em>Encryption at application layer</em> means that the payload of a MQTT PUBLISH message is encrypted with an application specific encryption and only clients who know how to encrypt the payload can read the original message. When not used together with TLS the transport is unencrypted and attackers could read the raw message on the wire. If the attacker does not know how to decrypt the payload, the payload of the MQTT PUBLISH message is secure. It is important to understand that only the payload of a MQTT PUBLISH can be encrypted, all other information like the <em>topic</em> of the message is unencrypted. <strong>Only PUBLISH payloads can be encrypted, all other MQTT messages like CONNECT cannot be secured with this technique</strong></p>
</div>
<div class="paragraph">
<p>Of course both encryption techniques can be used together. If it is important for your scenario that only few trusted clients can decrypt the contents of specific MQTT publishes and you want to secure your complete communication, this could be a great fit.</p>
</div>

</div>
</div>
<div class="sect3">
<h4 id="ssl-configuration-chapter">Configuration</h4>
<div class="paragraph">
<p>To enable SSL/TLS, the following properties have to be modified in the <code>configuration.properties</code> file. Please see <a href="#configuration-chaper">the Configuration chapter</a> for more details.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 5. Configurations for SSL/TLS</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>You have to set this property to <strong>true</strong> to enable SSL</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The port where SSL connections are received. Defaults to <strong>8883</strong></em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.handshakeTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The timeout in seconds for a SSL handshake. All clients which need longer for a SSL handshake than the specified timeout will be disconnected. Set to <strong>0</strong> if you do not want to set a timeout</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The cryptographic protocol which should be used for the secure communication between HiveMQ and its clients. Defaults to <strong>TLS</strong>.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keystore.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The location of the <a href="#java-key-stores-infobox">Java Key Store</a>. It is expected relatively to the HiveMQ home folder or as absolute path.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keystore.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The password for the Java Key Store. Leave empty if no password is set.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>truststore.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The location of the <a href="#java-key-stores-infobox">Java Trust Store</a>. It is expected relatively to the HiveMQ home folder or as absolute path.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>truststore.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The password for the truststore. Leave empty if no password is set.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At the moment only Keystores in the JKS format can be used. Also make sure that the password of your keypair is the same as the password of the keystore.</p>
</div>

</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_communication_protocol">Communication Protocol</h3>
<div class="paragraph">
<p>If no explicit SSL/TLS version was set via <code>ssl.protocol</code>, <strong>TLS</strong> (which is the same as TLSv1) is used to secure the communication between HiveMQ and the clients. If possible, it is recommended to use <strong>TLSv1.1</strong> or <strong>TLSv1.2</strong>, as these protocols tend to be more secure.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">TLS on different Java versions</div>
At the time of writing, Java 6 does not support TLSv1.1 and TLSv1.2. To enable these protocols, you should use at least use a current version of Java 7.
</td>
</tr>
</table>
</div>
<div id="java-key-stores-infobox" class="sidebarblock">
<div class="content">
<div class="title">Java Key Stores &amp; Trust Stores</div>
<div class="paragraph">
<p><em>Java Keystores</em> and <em>Java Truststores</em> are containers which contain information needed for SSL like X.509 certificates and keys. Typically each truststore and each keystore is persisted in one single file and they are protected by a master password.</p>
</div>
<div class="paragraph">
<p>Keystores and Truststores are conceptually similar but there is a difference in duty. In a SSL context, Keystores <strong>provide credentials</strong> and Truststores <strong>verify credentials</strong>. That means, a Keystore contains a public key certificate and the corresponding <strong>private key</strong>. <span class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</span>  Servers (like HiveMQ) typically use keystores to protect the private key for their SSL connections.</p>
</div>
<div class="paragraph">
<p>Truststores contain trusted certificates or certificates signed by a CA in order to identify the partner of the SSL connection. Typically clients which want to connect to a server have to store the certificate of the server (or the trusted CA when the server certificate was signed by a CA) to identify the server as a trusted server. When using <a href="#x509-client-auth-chapter">client certificate authentication</a> on the server side, the trusted certificates of the client also have to be in the truststore.</p>
</div>
<div class="paragraph">
<p>It is possible to use the same file as Keystore and Truststore. However, we recommend strongly to separate the Keystore and Truststore when using HiveMQ.</p>
</div>

</div>
</div>
<div class="paragraph">
<p>If you are not sure how to create a Keystore, you can find some useful information in <a href="#appendix-chapter">the Appendix of this document</a>.</p>
</div>

</div>
<div class="sect2">
<h3 id="hybrid-mode-chapter">Hybrid Mode</h3>
<div class="paragraph">
<p>HiveMQ can be configured to run in <em>Hybrid Mode</em>. That means that HiveMQ is able to handle standard TCP connections on one port and SSL/TLS connections on another port. This is completely transparent and all clients can communicate among themselves via Publish/Subscribe regardless how they are connected to the broker.
Clients can decide if they want to use SSL/TLS or a "standard" TCP, non SSL connection. This is extremely useful when some clients only have a unreliable network connectivity and/or very limited available bandwidth where every additional byte overhead matters and bandwidth efficiency is more important than a secure connection. In this case, these clients can connect to HiveMQ via the unsecured port while other clients can use a secure connection via the SSL enabled port.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 6. Relevant properties for enabling the hybrid mode in the configuration.properties file</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>You have to set this property to <strong>true</strong> to enable SSL</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl.hybridMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>If the hybrid mode is enabled and SSL is activated, SSL and standard TCP connections are supported simultaneously</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A prerequisite for enabling the hybrid mode is that SSL is enabled. Set the property <code>ssl.enabled</code> in the <code>configuration.properties</code> file to <code>true</code>. To enable the hybrid mode, also set the property <code>ssl.hybridMode</code> to <code>true</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Enable SSL to enable the hybrid mode</div>
Do not forget to enable SSL, otherwise the property <code>ssl.hybridMode</code> will have no effect.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of course it is also possible to allow different kinds of <a href="#authentication-and-permissions-chapter">Authentication</a> in such scenarios where hybrid mode is used. It is possible to allow <a href="#x509-client-auth-chapter">X.509 Client Certificate Authentication</a> for SSL secured connections to authenticate and authorize clients and <a href="#username-password-auth-chapter">Username/Password Authentication</a> for connections which are not secured by SSL.</p>
</div>
<div class="paragraph">
<p>Since HiveMQs hybrid mode is very powerful, it is possible to implement a scenario where SSL clients gain more permissions than non-SSL clients. So standard TCP connections could be implemented as anonymous clients while SSL clients could be implemented as authenticated clients. This comes in very handy when you are for instance providing MQTT services to other customers and you have to differentiate between different kind of clients.</p>
</div>
<div class="paragraph">
<p>The standard TCP connection port and the SSL port <strong>must be different ports</strong>. It is important to understand that it is not possible to connect to the standard TCP port with an SSL enabled client and it is not allowed to connect to the SSL port with clients who do not initiate a SSL handshake (= non-SSL clients).</p>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_secure_websockets">Secure Websockets</h3>
<div class="paragraph">
<p>HiveMQ has <a href="#websockets-chapter">native support for secure websockets</a>. Secure Websockets use the same keystore for the TLS encryption as standard MQTT over SSL. After making sure the keystore location and password are correct and <a href="#secure-websockets-configuration-chapter">secure websockets are enabled</a>, you can transparently use MQTT over secure websockets in web applications.</p>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="authentication-and-permissions-chapter">Authentication, Authorization &amp; Permissions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>HiveMQ offers several ways to implement authentication and authorization for your concrete use case. HiveMQ <em>allows everything for every client</em> by default. That means, if you don&#8217;t need any authentication or authorization for your scenario, you can skip this chapter. Even when you provide an username and password in the MQTT <em>CONNECT</em> message, HiveMQ ignores it and gives a client, which provides credentials the same permissions as a client, which do not provide any credentials.</p>
</div>
<div class="paragraph">
<p>You can use HiveMQs powerful <a href="#plugin-chapter">plugin system</a> to add authentication and authorization behaviour.</p>
</div>
<div class="paragraph">
<div class="title">Authentication</div>
<p>It is important to understand that there are two levels of authentication which can occur. The first type is the authentication with <a href="#x509-client-auth-chapter">X.509 client certificates</a> on the transport layer.
The second type is Username/Password authentication. This takes place when a MQTT <em>CONNECT</em> message is sent by the client and recognized on the application layer.</p>
</div>
<div class="paragraph">
<div class="title">Authorization &amp; Permissions</div>
<p>All authorization and permission logic has to be added to HiveMQ by <a href="#plugin-chapter">plugins</a>. For typical use cases, many plugins already exist, so it is sufficient in most cases to select your authorization plugin of choice and plug it into HiveMQ. A list of plugins can be found <a href="http://www.hivemq.com/plugins">here</a>.</p>
</div>
<div class="paragraph">
<p>Since X.509 client certificate authentication happens when the SSL Handshake occurs, there is no application context because this happens on the transport. Classically no application authorization logic can be performed at this stage, because this happens on the transport layer. Fortunately HiveMQ offers authorization based on SSL certificates via its powerful <a href="#plugin-chapter">plugin system</a>. This enables you to authenticate <strong>and</strong> authorize the client with X.509 client certificates.</p>
</div>
<div class="paragraph">
<p>When authentication via the MQTT <em>CONNECT</em> message is enabled, you can implement an authorization based on the credentials provided here. We experienced that for many use cases this is sufficient and easier to implement than SSL client certificate authentication. The credentials provided in the <em>CONNECT</em> message are username/password combinations which you can validate. Many plugins exits, which enable HiveMQ to read credentials from a file or database.</p>
</div>
<div class="sect2">
<h3 id="x509-client-auth-chapter">X.509 Client Certificate Authentication</h3>
<div class="paragraph">
<p>To activate X.509 client certificate authentication at transport layer in HiveMQ, there are a few prerequisites. Optionally it is possible to add additional application level authentication and authorization with the client certificate to implement more advanced scenarios where it is not sufficient enough to have authentication on the transport level.</p>
</div>
<div class="olist arabic">
<div class="title">Prerequisites</div>
<ol class="arabic">
<li>
<p>SSL must be enabled in the <code>configuration.properties</code> file.</p>
</li>
<li>
<p>A <a href="#java-key-stores-infobox">keystore</a> and a <a href="#java-key-stores-infobox">truststore</a> file must be configured in the <code>configuration.properties</code> file. The keystore must contain the server certificate and the server certificates	 private key. The truststore must contain all the client certificates or valid root certificates for the client certificates. See <a href="#ssl-configuration-chapter">the Configuration Chapter for more details</a>.</p>
</li>
<li>
<p>You have to set <code>ssl.clientAuthenticationMode</code> to <strong><code>optional</code></strong> or <strong><code>required</code></strong> in the <code>configuration.properties</code> file.</p>
</li>
<li>
<p><strong>(optional)</strong> <code>ssl.applicationClientAuthentication</code> must be set to <strong><code>true</code></strong> in the <code>configuration.properties</code> file if you want application level authentication &amp; authorization additionally to transport level authentication.</p>
</li>
<li>
<p><strong>(optional)</strong> If you need application level authentication &amp; authorization based on the X.509 client certificates, you need a HiveMQ <a href="#hivemq-plugins-url">plugin</a> which implements this.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Distinguish application and transport layer authentication</div>
It is very important to understand the difference between application layer authentication and transport layer authentication. Transport layer authentication is not a concept introduced by HiveMQ but a concept from the <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS-Handshake</a>. Application layer authentication is a security implementation of HiveMQ and is&#8201;&#8212;&#8201;as you could have guessed&#8201;&#8212;&#8201;application specific. It is absolutely possible to reuse your keystore and truststore for your transport layer client authentication in other server applications which support this concept, too.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#image-schematic-certificate-flow">The following diagram</a> shows the schematic X.509 client certificate authentication flow. Especially the SSL part of the diagram is technically not 100% correct but for the sake of grasping the concept this should be sufficient.</p>
</div>
<div id="image-schematic-certificate-flow" class="imageblock">
<div class="content">
<img src="images/uml/4_schematic_certificate_flow.png" alt="4_schematic_certificate_flow">
</div>
<div class="title">Figure 1. A schematic overview of the X.509 certificate authentication flow</div>
</div>

</div>
<div class="sect2">
<h3 id="username-password-auth-chapter">Username and Password Authentication and Authorization</h3>
<div class="paragraph">
<p>The most common practice for authentication when using MQTT is by far classic username/password credential matching. In the official MQTT specification, the <a href="http://public.dhe.ibm.com/software/dw/webservices/ws-mqtt/mqtt-v3r1.html#connect">MQTT <em>CONNECT</em> message</a> defines username and password sections in the message payload. HiveMQ utilizes these credential fields to enable application level authentication &amp; authorization.</p>
</div>
<div class="olist arabic">
<div class="title">Prerequisites</div>
<ol class="arabic">
<li>
<p>Install a plugin which handles credential matching.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In general, all clients whose credentials are invalid (the plugin decides if they match or not) are disconnected with the corresponding <a href="http://public.dhe.ibm.com/software/dw/webservices/ws-mqtt/mqtt-v3r1.html#connack">MQTT <em>CONNACK</em> message</a>, which returns <em>code 4 (bad username or password)</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">

You have to install a plugin, which enables the functionality to handle usernames and passwords. By default all username/password combinations (even anonymous) are allowed and all permissions are gained automatically.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#image-schematic-username-password-flow">The following diagram</a> shows a schematic overview how the authentication is performed.</p>
</div>
<div id="image-schematic-username-password-flow" class="imageblock">
<div class="content">
<img src="images/uml/4_schematic_username_password_flow.png" alt="4_schematic_username_password_flow">
</div>
<div class="title">Figure 2. A schematic overview of the Username/Password authentication flow</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>There are many plugins for authentication available and it is easy to create one at your own if you need something more fancy.</p>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_client_id_authentication_and_authorization">Client ID Authentication and Authorization</h3>
<div class="paragraph">
<p>Additional to <a href="#username-password-auth-chapter">classic username/password authentication</a> it is possible to add authentication and authorization logic with client identifiers. In principle this is exactly the same as username/password authentication with the difference that only the client identifier field of the <a href="http://public.dhe.ibm.com/software/dw/webservices/ws-mqtt/mqtt-v3r1.html#connect">MQTT <em>CONNECT</em> message</a> is used.</p>
</div>
<div class="olist arabic">
<div class="title">Prerequisites</div>
<ol class="arabic">
<li>
<p>Install a plugin which handles credentials authentication &amp; authorization.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For a list of plugins see the <a href="http://www.hivemq.com/plugins">plugin directory</a>.</p>
</div>
<div class="paragraph">
<p><a href="#image-schematic-clientid-flow">The following diagram</a> shows a schematic overview how the authentication is performed.</p>
</div>
<div id="image-schematic-clientid-flow" class="imageblock">
<div class="content">
<img src="images/uml/4_schematic_clientid_flow.png" alt="4_schematic_clientid_flow">
</div>
<div class="title">Figure 3. A schematic overview of the Username/Password authentication flow</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Use cases</div>
<div class="paragraph">
<p>There are several use cases for client identifier authentication and authorization logic. Some popular are:</p>
</div>
<div class="ulist">

<ul>
<li>
<p>You want to make sure that only client identifiers with a specific pattern can connect. Like <em>myapp-client1</em>. Only clients which start with <em>myapp</em> should connect.</p>
</li>
<li>
<p>You want to make sure that only a subset of clients connect to this HiveMQ cluster node based on the client identifier.</p>
</li>
<li>
<p>The client identifiers are MAC adresses of your devices and you cannot use username/password authentication because it is not possible to deploy a different username/password combination on every device.</p>
</li>
</ul>
</div>

</td>
</tr>
</table>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="hivemqdocs_logging">Logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Per default, HiveMQ writes all log data to the <code>log</code> subfolder.  For every day an archived log file is created with the name <em>hivemq.$DATE.log</em>.</p>
</div>
<div class="paragraph">
<p>The most current logfile is always named <em>hivemq.log</em>. The current log has a log rolling policy which means that it will always be archived on midnight. A file will be archived for 30 days before it gets deleted. It is recommended to manually backup the log files if you want to archive them longer.</p>
</div>
<div class="paragraph">
<p><a href="#log-folder-example">The following example</a> shows typical entries of the <code>log</code> subfolder.</p>
</div>
<div id="log-folder-example" class="exampleblock">
<div class="title">Example 1. log folder contents</div>
<div class="content">
<div class="literalblock">

<div class="content monospaced">
<pre>hivemq.log
hivemq.2013-05-11.log
hivemq.2013-05-12.log
hivemq.2013-05-13.log</pre>
</div>
</div>

</div>
</div>

</div>
</div>
<div class="sect1">
<h2 id="hivemqdocs_monitoring">Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ability to monitor server applications is very important for operating these applications. HiveMQ is no exception, in fact HiveMQ was designed to enable different kinds of monitoring easily. When using HiveMQ in critical infrastructure, it is strongly recommended to enable monitoring and use a decent application for displaying the relevant information you need for your operations.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 7. Relevant properties for monitoring in the configuration.properties file</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>statistics.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>If statistics are enabled or not. If you disable statistics, the $SYS topic is also disabled.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>statistics.updateInterval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Interval in seconds for updating statistics internally. Too low intervals could result in performance loss. It is recommended, that the statistics_update_interval is smaller than the sys_interval and the statistics_callback_interval</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Enable Statistics</div>
<p>To enable statistics, the <code>statistics.enabled</code> property has to be set to <code>true</code> in the <code>configuration.properties</code> file. It is important to set a reasonable <code>statistics.updateInterval</code> value (the default is 30 seconds). All counter statistics <span class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</span> are only updated once in an update interval while other statistics are updated all the time. If it is important for you to have up-to-date counter statistics, set the the update interval to a low value. Please be aware that when the update interval is too low, significant performance loss can occur. A too high update interval will result in old statistics.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Disabling statistics for performance</div>
You can disable statistics completely by setting <code>statistics.enabled</code> to <code>false</code> in the <code>configuration.properties</code> file. If you want to sacrifice monitoring abilities for maximum performance, this option is for you. Be sure to measure if you really gain significant performance wins when disabling statistics. It is not possible to enable or disable statistics without restarting HiveMQ.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If statistics are enabled, you can choose between several integrated monitoring options.</p>
</div>
<div class="sect2">
<h3 id="jmx-monitoring-chapter">JMX</h3>
<div class="paragraph">
<p>HiveMQ has extensive support for <a href="http://en.wikipedia.org/wiki/JMX"><em>Java Management Extensions (<strong>JMX</strong>)</em></a> to monitor HiveMQ. JMX is a proven standard and many external tools support JMX natively or via extensions.</p>
</div>
<div class="sect3">
<h4 id="hivemqdocs_enabling_jmx">Enabling JMX</h4>
<div class="paragraph">
<p>To enable JMX, open the <code>bin/run.sh</code> script and uncomment the line which begins with:</p>
</div>
<div class="literalblock">

<div class="content monospaced">
<pre>#JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote</pre>
</div>
</div>
<div class="paragraph">
<p>Be sure to set all JMX options properly according to Oracles official <a href="http://www.oracle.com/technetwork/java/javase/tech/docs-jsp-135989.html">JMX documentation</a>.</p>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_mbeans">MBeans</h4>
<div class="paragraph">
<p>When JMX is activated, There are a few MBeans which can be used for monitoring</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MBean Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.dcsquare.hivemq</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>This is the most important MBean for monitoring HiveMQ itself. All statistics can be monitored here.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Speed4j</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>All <a href="#plugin-monitoring-chapter">Plugin Monitoring</a> Information can be monitored here.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>All information about the Java Virtual Machine can be monitored here.</em></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="icon-caution" title="Caution"></i>
</td>
<td class="content">

It can be very dangerous to use JMX Operations because damage your running HiveMQ instance. Be sure to use JMX only to monitor and not to reconfigure HiveMQ at runtime.
</td>
</tr>
</table>
</div>

</div>

</div>
<div class="sect2">
<h3 id="monitoring-graphite-chapter">Graphite</h3>
<div class="paragraph">
<p><a href="http://graphite.wikidot.com/">Graphite</a> is a graphing system which is awesome for monitoring and displaying statistics of different data sources. It&#8217;s highly scalable and a perfect fit when monitoring many HiveMQ cluster nodes. Even for single HiveMQ instances it&#8217;s worth taking a look when the <a href="#jmx-monitoring-chapter">built-in JMX Monitoring</a> is not sufficient for your use case or when you want to preserve statistics history.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Graphite Server</div>
It is <strong>strongly recommended</strong> that Graphite is installed on a different server than HiveMQ.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 8. Relevant properties for Graphite in the configuration.properties file</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>graphite.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Enable the monitoring with Graphite</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>graphite.interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The interval for publishing metrics to Graphite in seconds. Too low intervals could results in possible performance losses.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>graphite.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The Graphite URL. Must be in the format "hostname:port"</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>graphite.metricPrefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A prefix for every metric which is sent to the Graphite instance. Useful for distinguishing between different HiveMQ servers or when using a hosted Graphite service to prefix the API Key</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>HiveMQ picks up the changes everytime it is (re)started. It is important to set a sane <code>graphite.interval</code>. It is recommended that this interval is at least as high as the <code>statistics.updateInterval</code>.</p>
</div>
<div class="paragraph">
<p>If you are using a hosted Graphite solution which requires a prefixed API Key, you can use the property <code>graphite.metricPrefix</code> for setting your API key.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Mixing HiveMQ statistics with other system statistics</div>
You can mix datasources in Graphite. Besides HiveMQ you can monitor the system resources like CPU or memory usage of a HiveMQ machine with tools like <a href="http://collectl.sourceforge.net/">collectl</a>.
</td>
</tr>
</table>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs__sys_topic">$SYS Topic</h3>
<div class="paragraph">
<p>HiveMQ supports a special MQTT topic (with subtopics) called <em>$SYS Topic</em>. MQTT clients can subscribe to this topic and receive system information and statistics of the HiveMQ MQTT broker. The following $SYS suptopics are exposed:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 9. $SYS subtopics</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Topic</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/broker/plugins</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Returns the installed plugins with all available information.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/broker/time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The current time on the broker. Only published on subscription.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/broker/uptime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The uptime of the broker in seconds. Only published on subscription.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/broker/version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The HiveMQ version. Only published on subscription.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/clients/connected</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The currently connected clients.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/clients/disconnected</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The clients which are not connected and have a persistent session on the broker.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/clients/maximum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The maximum number of active clients which were connected simultaneously.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/clients/total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The total count of connected and disconnect (with persistent session) clients.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/load/bytes/received</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The total bytes received</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/load/bytes/sent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The total bytes sent</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/messages/publish/received</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The total <em>MQTT PUBLISH</em> messages received.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/messages/publish/sent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The total <em>MQTT PUBLISH</em> messages sent.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/messages/received</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The total <em>MQTT</em> messages received.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/messages/retained/count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The amount of all retained messages.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/messages/sent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The total <em>MQTT</em> messages sent.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$SYS/subscriptions/count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The total count of subscriptions</em></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">$SYS Topic standard</div>
There is no standardization or common definition of what <em>$SYS topics</em> should exist. These special topics are not fully interoperable between MQTT message brokers and clients must not rely on these topics.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is not possible for any client to publish to the <em>$SYS</em> topic or one of its subtopics. These values are published exclusively by HiveMQ.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 10. Relevant properties for the $SYS topics in the configuration.properties file</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sys.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>If the $SYS tree should be available or not.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sys.interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Time in seconds between publishes of the $SYS tree</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>$SYS</em> topics are <strong>enabled by default</strong>. To disable the publishing of the <em>$SYS</em> topic tree, set the <code>sys.enabled</code> property to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>Be sure to set the <code>sys.interval</code> property to a value which is at least the value of <code>statistics.updateInterval</code>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Disabled statistics</div>
The <em>$SYS</em> topic values are not published when statistics are disabled. Be sure to set <code>statistics.enabled</code> to <code>true</code> when you want to use the <em>$SYS</em> topics.
</td>
</tr>
</table>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_resource_consumption_logging">Resource Consumption Logging</h3>
<div class="paragraph">
<p>For basic resource logging purposes like logging CPU and memory consumption, HiveMQ is able to append system resource information to the log file frequently. This is useful in scenarios where you do not need a full monitoring solution like <a href="#monitoring-graphite-chapter">Graphite</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Resource monitoring</div>
For serious use cases it is recommended to use a monitoring solution like <a href="#monitoring-graphite-chapter">Graphite</a> to monitor the resource consumption of a system. <a href="http://collectl.sourceforge.net/">Collectl</a> works very good as data source for Graphite in such cases.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 11. Relevant properties for resource consumption logging in the configuration.properties file</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>measureResourceConsumption.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Enables the resource consumption logging.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>measureResourceConsumption.interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Time in seconds between logging of the resource consumption</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Resource consumption logging is <strong>disabled by default</strong>. To enable the resource consumption logging, set the property <code>measureResourceConsumption.enabled</code> to <code>true</code>. To avoid too many log entries, set the <code>measureResourceConsumption.interval</code> to a sane number.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">

It is probably hard to identify performance peaks when using this technique for monitoring HiveMQ because the resource consumption statistics are collected once every interval and are only a snapshot.
</td>
</tr>
</table>
</div>

</div>
<div class="sect2">
<h3 id="plugin-monitoring-chapter">Monitoring of Plugins</h3>
<div class="paragraph">
<p>With the powerful <a href="#plugin-chapter">HiveMQ Plugin System</a> it is possible to add integration plugins for virtually everyting you can imagine. A common pitfall when writing plugins is that these plugins block the HiveMQ communication threads in some way and the HiveMQ overall performance can decrease dramatically. Fortunately HiveMQ offers a way to monitor the execution time of plugins on specific callbacks via <a href="#jmx-monitoring-chapter">JMX</a>.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 12. Relevant properties for plugin monitoring in the <code>application.configuration</code> files</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plugin.performanceMonitoring</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Enable to monitor the performance of plugins. When enabled this will result in a significant performance loss.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>plugin.performanceMonitoring</code> property must be set to <code>true</code> when you want to enable the plugin performance monitoring. Since the property resides in the <code>application.properties</code> file, the monitoring can be enabled and disabled at runtime. It is however good practice to only enable the performance monitoring when needed or when developing plugins.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Performance Considerations</div>
Enabling plugin performance monitoring should only be enabled for debugging and should not be activated in production as the plugin monitoring can decrease the HiveMQ performance dramatically under high load.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To inspect the different plugin, open <em>JConsole</em> or <em>JVisualVM (with the MBean Plugin)</em> and look at the <strong>MBean "Speed4j"</strong>. All callbacks which are implemented by the plugins are shown and you can inspect different statistics for the callback. The relevant values are:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 13. JMX Plugin Performance Monitoring attribute values</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>callback/95</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The average execution time of the callback in ms after applying a 95th percentile</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>callback/avg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The absolute average execution time of the callback in ms</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>callback/count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The execution count of the callback</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>callback/max</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The slowest execution time of the callback in ms</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>callback/min</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The fastest execution time of the callback in ms</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>callback/stddev</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The average execution time of the callback in ms after applying standard deviation</em></p></td>
</tr>
</tbody>
</table>

</div>

</div>
</div>
<div class="sect1">
<h2 id="cluster-chapter">Clustering</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">

The cluster feature has improved dramatically with the HiveMQ 2.3.0 release and the cluster configurations are not backwards compatible with older HiveMQ versions. If you are upgrading from an older HiveMQ version with cluster enabled, please read the next paragraphs carefully.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One of the outstanding features of HiveMQ is the ability to form a MQTT Broker cluster. It is easy to implement High Availability Services with HiveMQ as well as high performance clusters with massive message throughput. The elastic cluster functionality makes it easy to add cluster nodes at runtime. HiveMQ utilizes <a href="http://www.jgroups.org/">JGroups</a> for the transport and so it is possible to implement even very complex scenarios.</p>
</div>
<div class="paragraph">
<p>Using MQTT broker clusters has advantages over <a href="#bridges-chapter">broker bridging</a>, which is essentially just a broker acting as a client. Although bridging is not an official part of the MQTT spec and there are many disadvantages compared to clustering, there are some scenarios where it makes sense to use bridging. More about Bridging and how to configure it with HiveMQ, can be found in <a href="#bridges-chapter">the next chapter</a>.</p>
</div>
<div id="bridges-vs-clustering" class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Cluster vs Bridging</div>
Bridging has some disadvantages when it comes to reliability and performance. Although MQTT is a very lightweight protocol, you bear the whole protocol overhead with you with every message when using bridging. To guarantee that a message arrives at the bridged broker only once, bridging has to be configured with MQTT QoS 2, which is a massive overhead compared to the cluster communication mechanisms. Bridges only allow point-to-point broker connections which makes it harder to scale with many brokers. Also, hot standby scenarios with loadbalancers in front are trickier with bridges due to the lack of a replicated client sessions across the brokers.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="hivemqdocs_prerequisites">Prerequisites</h3>
<div class="paragraph">
<p>Clustering is <strong>disabled</strong> by default. To enable clustering you need to change the <code>configuration.properties</code> file and add additional files to your <code>conf</code> folder. The concrete steps are listed below.</p>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_enabling_cluster_support">Enabling cluster support</h3>
<div class="paragraph">
<p>By default clustering is disabled and HiveMQ needs to be started in <em>cluster mode</em> in order to try to form a cluster with other HiveMQs. This has the advantage that HiveMQ has a significant faster startup time when running in standalone mode than in cluster mode.</p>
</div>
<div class="sect3">
<h4 id="hivemqdocs_changes_in_the_configuration_properties_file">Changes in the configuration.properties file</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 14. Relevant properties for limiting connections in the configuration.properties file</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Enables or disables the cluster. By default the cluster is disabled. Set to <code>true</code> if you want to enable cluster support.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>No additional settings need to be configured in the <code>configuration.properties</code> file</p>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_copying_all_cluster_files_to_the_conf_folder">Copying all cluster-* files to the conf folder</h4>
<div class="paragraph">
<p>These are the concrete steps you should follow to enable clustering:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Decide which kind of cluster member discovery you want to use. There are out-of-the-box examples for <a href="#cluster-udp">UDP</a>, <a href="#cluster-tcp">TCP</a> and <a href="#cluster-aws">AWS S3</a> auto discovery available.</p>
</li>
<li>
<p>Copy all <code>cluster-<strong></code> files from the example folder you chose to the <code>conf</code> folder of HiveMQ. You should now have 5 <code>cluster-</strong></code> files.</p>
</li>
<li>
<p>(optional and for experts only!) Modify the relevant parts of the +cluster-*.xml+s to optimize the cluster communication for your concrete use case. Use the <a href="http://www.jgroups.org/manual/html/protlist.html">JGroups Protocol Documentation</a> for that.</p>
</li>
</ol>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Misconfiguration</div>
When modifying the <code>cluster-*.xml</code> files, you can break the cluster when you are not 100% sure what you are doing. No guarantees can be made for data integrity or message broker functionality when misconfiguring the files.
</td>
</tr>
</table>
</div>

</div>

</div>
<div class="sect2">
<h3 id="cluster-udp">Elastic Cluster with UDP Multicast</h3>
<div class="paragraph">
<p>When you have control over your network infrastructure or you need a true auto discovery mechanism which detects cluster nodes when they start up in the same network, then UDP <a href="#ip-multicast">multicast</a> is a perfect fit. This is a master-master scenario, so there is no single point of failure on the HiveMQ node side and you can scale out quickly by just starting up a new HiveMQ node. It&#8217;s also a good starting point for playing around with HiveMQs cluster functionality if you are new to these topics.</p>
</div>
<div class="paragraph">
<p>Please follow these steps to get your UDP cluster up and running. These steps must be made for every HiveMQ cluster node.</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Copy all <code>cluster-<strong></code> files from the <em>conf/examples/udp</em> folder to the <code>conf</code> folder of HiveMQ. You should now have 5 <code>cluster-</strong></code> files.</p>
</li>
<li>
<p>(optional) Modify the <code>cluster.xml</code> and adjust the parameters to your need.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>HiveMQ instances will automatically form a cluster now when the nodes find themselves.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">It doesn&#8217;t work!!!</div>
<div class="paragraph">
<p>Although we do our best do give you the smoothest cluster setup experience, cluster configuration is a complex subject and there are many error sources. Here a few things you could check if something doesn&#8217;t work:</p>
</div>
<div class="ulist">

<ul>
<li>
<p>Is your firewall enabled and not configured accordingly (<strong>Tip:</strong> Disable the firewall for testing)</p>
</li>
<li>
<p>Are your cluster nodes in the same network?</p>
</li>
<li>
<p>Is multicast enabled on your machine? Is multicast supported by your switch/router?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Be sure to read the <a href="http://www.jgroups.org/manual/html/ch02.html">JGroups Documentation</a> to help troubleshooting.</p>
</div>

</td>
</tr>
</table>
</div>

</div>
<div class="sect2">
<h3 id="cluster-tcp">Fixed size cluster with TCP</h3>
<div class="paragraph">
<p>There are some scenarios where you probably do not want the HiveMQ cluster to be elastic, can&#8217;t or don&#8217;t want to use multicast, or you don&#8217;t want auto discovery because you already know all your cluster node IP addresses. This is often the case when you want to build something like a High Availability MQTT Cluster <span class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</span> for example.</p>
</div>
<div class="paragraph">
<p>Please follow these steps to get your TCP cluster up and running. You will get a cluster which uses TCP for transport and has a list of server IP addresses hardcoded. These steps have to be made for every HiveMQ cluster node.</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Copy all <code>cluster-<strong></code> files from the <em>conf/examples/tcp</em> folder to the <code>conf</code> folder of HiveMQ. You should now have 5 <code>cluster-</strong></code> files.</p>
</li>
<li>
<p>Modify the <code>cluster-*.xml</code> files and add the server IPs to <code>initial_hosts</code> in the <code>TCPPING</code> section.</p>
</li>
<li>
<p>(optional) Modify the <code>cluster.xml</code> and adjust the parameters to your need.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can of course use TCP for the node communication transport and use UDP multicast for auto discovering new nodes like in <a href="#cluster-udp">the previous chapter</a>. For detailed information, please see the <a href="#jgroups-protocol-list-url">JGroups Documentation</a>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>Replace:</p>
</div>
<div class="literalblock">

<div class="content monospaced">
<pre>&lt;TCPPING initial_hosts="localhost[7800]" port_range="0"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>with</p>
</div>
<div class="literalblock">

<div class="content monospaced">
<pre>&lt;TCPPING initial_hosts="192.168.1.26[7800]" port_range="0"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>You could also enter multiple initial hosts. For example:</p>
</div>
<div class="literalblock">

<div class="content monospaced">
<pre>&lt;TCPPING initial_hosts="192.168.1.26[7800],192.168.1.27[7800]" port_range="0"/&gt;</pre>
</div>
</div>

</div>
<div class="sect2">
<h3 id="cluster-aws">Elastic Cluster with AWS S3 auto discovery</h3>
<div class="paragraph">
<p>HiveMQ works perfectly on AWS, nevertheless there are some things that are a little bit different from running HiveMQ on your own servers. The explanation of a <a href="#cluster-tcp">TCP fixed size cluster</a> does work similar on AWS, but of course an <a href="http://aws.amazon.com/articles/1346">Elastic IP address</a> is needed. The UDP multicast example doesn&#8217;t work on EC2, because Amazon doesn&#8217;t allow <a href="http://en.wikipedia.org/wiki/Multicast">multicast</a>. In order to build an elastic HiveMQ Cluster on AWS, the <a href="http://aws.amazon.com/s3/">Amazon Simple Storage Service (S3)</a> is leveraged for storing all necessary data for discovering other nodes. The following is a step-by-step guide on how to get a HiveMQ cluster up and running on AWS with auto-discovery by the use of S3 buckets.</p>
</div>
<div class="sect3">
<h4 id="hivemqdocs_deploy_2_or_more_ec2_instances_with_ami">Deploy 2 or more EC2 instances with AMI</h4>
<div class="paragraph">
<p>In this tutorial EC2 instances without a <a href="https://aws.amazon.com/vpc/">AWS Virtual Private Cloud</a> are used, because this makes the general cluster setup easier to understand. We recommend to run all HiveMQ cluster nodes in a VPC, so only the relevant MQTT ports are open to the public. It is very straight-forward to use the described steps and apply them to a VPC, if you are familiar with the necessary steps to configure a VPC on AWS.</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Open <a href="https://console.aws.amazon.com/ec2">EC2 Console</a></p>
</li>
<li>
<p>Go to <code>Instances</code> in the menu</p>
</li>
<li>
<p>Click on <code>Launch Instance</code></p>
</li>
<li>
<p>Select <code>Amazon Linux AMI 2014.03.1 with 64bit</code> (or newer) or your favorite liunx distribution</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">AMI - Amazon Linux</div>
The advantage of AMI is that it already has Java installed and other useful tools in order to get started right away.
</td>
</tr>
</table>
</div>
<div class="olist arabic">

<ol class="arabic" start="5">
<li>
<p>Choose the appropriate Tier for your use case</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">AWS Tiers</div>
HiveMQ runs on all tiers, it totally depends how many client connections and messages per second you expect.
</td>
</tr>
</table>
</div>
<div class="olist arabic">

<ol class="arabic" start="6">
<li>
<p>Click on <code>Next:Configure Instance Details</code></p>
<div class="olist loweralpha">

<ol class="loweralpha" type="a">
<li>
<p>Number of instances: <code>2</code> (or more)</p>
</li>
<li>
<p>Request Spot Instances: <code>false</code></p>
</li>
<li>
<p>Network: <code>EC2-Classic</code></p>
</li>
<li>
<p>IAM role: <code>none</code></p>
</li>
<li>
<p>Shutdown behavior: <code>Stop</code></p>
</li>
</ol>
</div>

</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Instance Details and Storage</div>
The provided details are ideal for a simple default setup. If you are familiar with AWS you can configure your preferred settings.
</td>
</tr>
</table>
</div>
<div class="olist arabic">

<ol class="arabic" start="7">
<li>
<p>Click on <code>Next:Add Storage</code></p>
</li>
<li>
<p>Click on <code>Next:Tag Instance</code></p>
</li>
<li>
<p>Click on <code>Next:Configure Security Groups</code></p>
<div class="ulist">

<ul>
<li>
<p>Create a new Security Group with the following rules</p>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:20%;">
<col style="width:20%;">
<col style="width:20%;">
<col style="width:20%;">
<col style="width:20%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Port Range</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SSH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anywhere</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SSH Access</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Custom TCP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1883</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anywhere</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MQTT</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Custom TCP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anywhere</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MQTT over Websockets</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Custom TCP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7800</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anywhere</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Cluster (TCP)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Custom TCP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9750-9800</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anywhere</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Cluster (FD_Sock)</em></p></td>
</tr>
</tbody>
</table>

</li>
</ul>
</div>

</li>
<li>
<p>Click on <code>Review and Launch</code></p>
</li>
<li>
<p>Click on <code>Launch</code></p>
</li>
<li>
<p>Create or use an existing Key Pair</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Key Pair</div>
<div class="paragraph">
<p>The key pair is your key to access all the instances. At creation time Amazon will show you a <code>secret access key</code> and an <code>access key</code>. They won&#8217;t be displayed again, so make sure to hold them on a safe place.</p>
</div>

</td>
</tr>
</table>
</div>
<div class="olist arabic">

<ol class="arabic" start="13">
<li>
<p>Wait until all newly created instances have a green status</p>
</li>
</ol>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_configure_your_s3_bucket">Configure your S3 Bucket</h4>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Open the <a href="https://console.aws.amazon.com/s3">S3 Console</a></p>
</li>
<li>
<p>Click <code>Create Bucket</code></p>
</li>
<li>
<p>Choose a name and a region near to your location</p>
</li>
</ol>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_install_and_configure_hivemq">Install and Configure HiveMQ</h4>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>SSH to the machines you need 2 things: the <code>key file</code> and the <code>IP address</code> or the <code>Amazon DNS name</code> (something like <code>ec2-255-255-255-255.eu-west-1.compute.amazonaws.com</code>) of the machines</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>ssh -l ec2-user -i keypair.pem &lt;IPaddress&gt;</code></pre>
</div>
</div>

</li>
<li>
<p>Transfer HiveMQ to each instance</p>
<div class="olist loweralpha">

<ol class="loweralpha" type="a">
<li>
<p>Use wget to download the current version</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>wget --content-disposition http://www.hivemq.com/downloads/releases/latest</code></pre>
</div>
</div>

</li>
<li>
<p><strong>or</strong> Copy HiveMQ with scp from you computer</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>scp -i keypair.pem ~/Downloads/hivemq.zip ec2-user@&lt;IPaddress&gt;:/home/ec2-user</code></pre>
</div>
</div>

</li>
<li>
<p>Unzip HiveMQ</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>sudo su
cp /home/ec2-user/hivemq.zip /opt/
unzip hivemq.zip
mv hivemq-X.X. hivemq</code></pre>
</div>
</div>

</li>
</ol>
</div>

</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Run HiveMQ as a service?</div>
The complete install instructions can be found <a href="#installation">here</a> and these include all details on how to install HiveMQ as a service on different operating systems.
</td>
</tr>
</table>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_prepare_hivemq_for_cluster_usage">Prepare HiveMQ for cluster usage</h4>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Copy all <code>cluster-<strong></code> files from the <em>conf/examples/aws</em> folder to the <code>conf</code> folder of HiveMQ. You should now have 5 <code>cluster-</strong></code> files.</p>
</li>
<li>
<p>Add your <code>Amazon Secret Key</code>, <code>Amazon Key</code> to the <code>S3_Ping</code> in each <code>cluster-*.xml</code> file</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>&lt;S3_PING secret_access_key="YOUR_SECRET_ACCESS_KEY" access_key="YOUR_ACCESS_KEY" location="YOUR_S3_BUCKET_NAME"/&gt;</code></pre>
</div>
</div>

</li>
</ol>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_test_the_cluster">Test the Cluster</h4>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>SSH to each instance</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>ssh -l ec2-user -i keypair.pem &lt;IP Address&gt;</code></pre>
</div>
</div>

</li>
<li>
<p>Start HiveMQ on each instance</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>sudo su
./opt/hivemq/bin/run.sh</code></pre>
</div>
</div>

</li>
<li>
<p>Wait for the following lines</p>
<div class="listingblock">

<div class="content monospaced">
<pre>Nodes [ip-10-72-154-154-35530] joined the cluster
Current Cluster size is 2 with the following Nodes: [ip-10-73-199-175-40394, ip-10-72-154-154-35530]</pre>
</div>
</div>
<div class="paragraph">
<p><strong>You have successfully formed a HiveMQ Cluster!</strong></p>
</div>

</li>
<li>
<p>Test the Cluster functionality</p>
<div class="ulist">

<ul>
<li>
<p>Start a Subscriber to one of the instances (for example mosquitto_sub)</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>mosquitto_sub -h &lt;IPaddress-instance1&gt; -t test</code></pre>
</div>
</div>

</li>
<li>
<p>Publish to another instance</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>mosquitto_pub -h &lt;IPaddress-instance2&gt; -t test -m "ClusterTest"</code></pre>
</div>
</div>

</li>
<li>
<p>Everything works perfectly, if the subscribing clients gets the test message.</p>
</li>
</ul>
</div>

</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Need help?</div>
If you need professional support for your HiveMQ cluster, dc-square GmbH offers consulting for configuring, optimizing and managing HiveMQ clusters for you. <a href="mailto:hivemq@dc-square.de">Contact us</a> to find out how we can help you.
</td>
</tr>
</table>
</div>

</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="bridges-chapter">Bridges</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes it is desirable to connect MQTT brokers together. This is possible with the <em>Bridge</em> functionality. Bridges are a good way to forward MQTT messages to another broker directly. When bridging is activated, HiveMQ will act as a standard MQTT client <span class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnote_6" title="View footnote.">6</a>]</span></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/bridges/bridge-hierarchy.png" alt="Hierarchic Bridging Example">
</div>
<div class="title">Figure 4. Hierarchic bridging</div>
</div>
<div class="paragraph">
<p><strong>Hierarchic bridging</strong> is typically used if you want to consolidate and forward messages to another remote broker. Typically the bridge connection is not bi-directional (as in <em><em>both brokers are bridges which bridge to each other</em></em>).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/bridges/bridge-horizontal.png" alt="Horizonal Bridging Example">
</div>
<div class="title">Figure 5. Horizontal bridging</div>
</div>
<div class="paragraph">
<p><strong>Horizontal bridging</strong> is very useful if you have different brokers which should exchange some important MQTT messages. It is not recommended that brokers forward every message, this won&#8217;t scale very well. <span class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnote_7" title="View footnote.">7</a>]</span>.</p>
</div>
<div class="paragraph">
<p>Of course it&#8217;s possible to do hierachic and horizontal bridging at the same time. And of course HiveMQ is interoperable with other MQTT brokers, see the <a href="#bridges-interoperability">Interoperability section</a> for more information.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Bridges are not meant for scaling out</div>
Bridges are not really meant for scaling out a MQTT broker, they only excel when forwarding MQTT messages on specific topics or when <a href="#bridges-remapping-of-topics">rewriting MQTT topics and resend it to another broker</a>. If you want to scale your HiveMQ broker out, take a look at <a href="#cluster-chapter">clustering</a> and read the <a href="#bridges-vs-clustering"><em>Bridges vs Clustering</em> Section</a>. In some scenarios, it may be possible to scale with bridges, though.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="bridge-protocol">The MQTT Bridge protocol</h3>
<div class="paragraph">
<p>While a bridge connection is essentially just a standard MQTT client connection to another broker, there is an unofficially specified bridge protocol which is implemented by many <a href="https://github.com/mqtt/mqtt.github.io/wiki/Server%20support">MQTT brokers</a>.</p>
</div>
<div class="paragraph">
<p>When another MQTT broker which wants to bridge to HiveMQ implements that protocol, HiveMQ is aware that this is a bridge connection. In this case, HiveMQ will behave differently as with a standard MQTT client connection:</p>
</div>
<div class="ulist">

<ul>
<li>
<p>Retained flags are propagated for incoming PUBLISH MQTT messages</p>
</li>
<li>
<p>HiveMQ plugins can implement custom logic for bridge connections. It is possible to find out if a client is a bridge.</p>
</li>
<li>
<p>Bridges are allowed to publish to a specific <em>NotificationTopic</em> which can be in the <em>$SYS</em> topic tree. Standard MQTT clients are not allowed to publish on the <em>$SYS</em> topic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Technical details</div>
<p>Technically speaking, if a client connects with the bridge protocol, it just sends a MQTT <em>CONNECT</em> message with a different MQTT version. The MQTT version is just OR&#8217;d with a bitmask of <strong>10000000</strong> (which is <strong>0x80</strong> in hex).</p>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_bridge_types">Bridge Types</h3>
<div class="paragraph">
<p>There are 4 different types of bridges you can use.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:20%;">
<col style="width:80%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bridge Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Automatic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bridge connection will be started automatically when the broker starts and it will try with best effort to reconnect if the connection drops or if the connection failed.<br>
<strong>This is the default connection type</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Manual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This bridge will not start and stop automatically. You must use a plugin which utilizes the <a href="#bridge-manager-service"><em>BridgeManagerService</em></a> from the HiveMQ Plugin SPI to start and stop this type of bridge. This bridge won&#8217;t reconnect automatically if it disconnected unexpectedly, so make sure you implemented some kind of heartbeat when using this bridge type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Lazy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This bridge will not start automatically on broker startup. Lazy bridges queue messages until a threshold is reached and then they connect to the remote broker. After a idle timeout it will automatically disconnect again if no messages are delivered in the meantime.<br>
This type is very useful if you only want to connect a bridge if needed or if you want to do some kind of <em>batching</em>.<br>
If you want to use the lazy mode for batching, consider setting the idle timeout to a very low value. Please make sure that the idle timeout is shorter than the keepAlive value, otherwise a bridge connection is never considered idle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Once</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This bridge will start automatically on broker startup. If the connection drops, this bridge type won&#8217;t try to reconnect. It is possible to restart this type of bridge manually with the <a href="#bridge-manager-service"><em>BridgeManagerService</em></a> in HiveMQ plugins.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Which bridge should be used?</div>
While all of the bridge types may be useful, in most cases the <code>Automatic</code> bridge type should be good to start with and it&#8217;s the recommend way to do bridging.<br>
If you want to control bridges with the HiveMQ plugin mechanism, then the <code>Manual</code> bridge type could be useful.<br>
The <code>Lazy</code> bridge type may be an option if your scenario doesn&#8217;t allow a permanent bridge connection to another broker. However, if you need fine grained control, a HiveMQ plugin may be the better choice.<br>
The <code>Once</code> bridge type is supported for compatibility reasons to other brokers. It&#8217;s not recommended to use this type of bridge if you&#8217;re not sure this is the behaviour you want.
</td>
</tr>
</table>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_configuration">Configuration</h3>
<div class="sect3">
<h4 id="hivemqdocs_enabling_bridges">Enabling Bridges</h4>
<div class="paragraph">
<p>To enable bridges, just rename the <code>bridges-example.xml</code> to <code>bridges.xml</code>.</p>
</div>
<div class="paragraph">
<p>Next step is to configure the bridges.xml file.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">XSD for the bridges.xml</div>
If you are using a decent XML editor, you will get code completion for your bridge configuration when using the XSD file located here: <a href="http://www.hivemq.com/bridges/bridge.xsd">http://www.hivemq.com/bridges/bridge.xsd</a>
</td>
</tr>
</table>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_configuration_options_2">Configuration options</h4>
<div class="paragraph">
<p>Due to the complex, hierarchic nature of bridges, the HiveMQ bridge configuration is done with an XML file.</p>
</div>
<div class="sect4">
<h5 id="bridge-config-toplevel">Bridge Properties</h5>
<div class="paragraph">
<p>This describes the top level properties of a bridge connection.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 15. Properties</caption>
<colgroup>
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connectionName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique name of the connection. This name is used for identifying the bridge connection locally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clientId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The MQTT client identifier of the HiveMQ broker when connecting to a remote broker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addresses</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of <a href="#bridge-config-address">Addresses</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The remote broker addresses this bridge tries to connect to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>topicPatterns</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of <a href="#bridge-config-topic-pattern">TopicPatterns</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The topic patterns for the <a href="#bridges-remapping-of-topics">remapping of topics</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>notificationsEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, the bridge will publish its connection state to the remote broker. A retained message is published to the topic $SYS/broker/connection/&lt;clientid&gt;/state (unless configured otherwise) on start and on disconnection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>notification</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#bridge-config-notification">Notification Node</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The notification section where you can configure how the bridge will notify the remote broker about its connection state. Make sure that <code>notificationsEnabled</code> is set to <code>true</code> if you want to use that feature.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tryPrivate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, the bridge tries to connect with the <a href="#bridge-protocol">bridge protocol</a> instead of a standard MQTT connection. This only works on brokers which implement the bridge protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>roundRobin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this bridge has configured more than one address, round robin treats each of these addresses equal. The bridge will try to connect to the next address on connection if round robin is active. If round robin is disabled, then the first address is treated as the main bridge connection. If the connection drops with round robin enabled, the bridge will try to reconnect to the main bridge everytime it loses the connection from another address. roundRobin is <em>enabled by default</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cleanSession</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the client should connect with a clean session or with a persistent session (cleanSession=false). If you connect with a persistent session, all subscriptions on the remote broker are kept, even if this HiveMQ instance disconnects unexpectedly. On cleanSession=true, all topic subscriptions of this HiveMQ instance on the remote broker will be deleted if the connection drops.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>idleTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">positive number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The idle timeout of a lazy bridge in second. If there isn&#8217;t any in- or outgoing traffic for this bridge for this long, the lazy bridge will disconnect. Should be smaller than the keepAlive value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keepAlive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">positive number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The MQTT keepalive timeout used for hearbeats. Defaults to 60 seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>restartTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">positive number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>Automatic</code> bridge will wait this long before trying to reconnect to the remote broker after it was disconnected. Defaults to 30 seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">positive number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of messages a <code>Lazy</code> bridge queues before it connects to the remote broker. Defaults to 10 messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username to for authentication with the remote broker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password to authenticate with the remote broker.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example bridge configuration</div>
<div class="content monospaced">
<pre class="prettyprint xml language-xml"><code>  ...
    &lt;bridge&gt;
        &lt;connectionName&gt;Bridge1&lt;/connectionName&gt;
        &lt;addresses&gt;
            ...
        &lt;/addresses&gt;
        &lt;clientId&gt;bridgeClient&lt;/clientId&gt;
        &lt;topicPatterns&gt;
            ...
        &lt;/topicPatterns&gt;
        &lt;cleanSession&gt;true&lt;/cleanSession&gt;
        &lt;idleTimeout&gt;10&lt;/idleTimeout&gt;
        &lt;notificationsEnabled&gt;true&lt;/notificationsEnabled&gt;
        &lt;notification&gt;
            ...
        &lt;/notification&gt;
        &lt;cleanSession&gt;true&lt;/cleanSession&gt;
        &lt;clientId&gt;clientId&lt;/clientId&gt;
        &lt;keepAlive&gt;60&lt;/keepAlive&gt;
        &lt;username&gt;user&lt;/username&gt;
        &lt;password&gt;secret&lt;/password&gt;
        &lt;restartTimeout&gt;20&lt;/restartTimeout&gt;
        &lt;roundRobin&gt;false&lt;/roundRobin&gt;
        &lt;threshold&gt;10&lt;/threshold&gt;
        &lt;tryPrivate&gt;true&lt;/tryPrivate&gt;
    &lt;/bridge&gt;
  ...
</code></pre>
</div>
</div>

</div>
<div class="sect4">
<h5 id="bridge-config-address">Address Properties</h5>
<div class="paragraph">
<p>Addresses are direct childs of the <a href="#bridge-config-toplevel"><code>bridge</code></a> nodes.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hostname or IP address of the remote broker to connect to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number between 1 and 65535</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port of the remote broker to connect to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tls</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#bridge-config-tls">TLS Type</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings for secure connections to the remote broker</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example Address configuration</div>
<div class="content monospaced">
<pre class="prettyprint xml language-xml"><code>    ...
    &lt;bridge&gt;
        &lt;addresses&gt;
            &lt;address&gt;
                &lt;host&gt;localhost&lt;/host&gt;
                &lt;port&gt;1884&lt;/port&gt;
            &lt;/address&gt;
        &lt;/addresses&gt;
    &lt;/bridge&gt;
    ...</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="bridge-config-tls">TLS Properties</h6>
<div class="paragraph">
<p>The TLS properties are direct childs of the <a href="#bridge-config-address"><code>address</code></a> node. Example:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSLv3/TLS/TLSv1/TLSv1.1/TLSv1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The TLS/SSL protocol version to use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>authentication</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If client certificate authentication should be used. A keystore is mandatory if you want to use this.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keystore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path to the Java Key Store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keystorePassword</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the Java Key Store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>truststore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path to the Java Trust Store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>truststorePassword</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the Java Trust Store</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example TLS configuration</div>
<div class="content monospaced">
<pre class="prettyprint xml language-xml"><code>         ...
        &lt;addresses&gt;
            &lt;address&gt;
                &lt;host&gt;localhost&lt;/host&gt;
                &lt;port&gt;1884&lt;/port&gt;
                &lt;tls&gt;
                    &lt;protocol&gt;SSLv3&lt;/protocol&gt;
                    &lt;authentication&gt;true&lt;/authentication&gt;
                    &lt;keystore&gt;/home/user/keystore.jks&lt;/keystore&gt;
                    &lt;keystorePassword&gt;keystorePW&lt;/keystorePassword&gt;
                    &lt;truststore&gt;/home/user/truststore.jks&lt;/truststore&gt;
                    &lt;truststorePassword&gt;truststorePW&lt;/truststorePassword&gt;
                &lt;/tls&gt;
            &lt;/address&gt;
        &lt;/addresses&gt;
        ...
</code></pre>
</div>
</div>

</div>

</div>
<div class="sect4">
<h5 id="bridge-config-notification">Notification Properties</h5>
<div class="paragraph">
<p>Notification is a direct child of the <a href="#bridge-config-toplevel"><code>bridge</code></a> node.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>topic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>qos</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/1/2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The quality of service level notifications are sent with.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example Notification configuration</div>
<div class="content monospaced">
<pre class="prettyprint xml language-xml"><code>        ...
        &lt;notification&gt;
            &lt;topic&gt;my/broker/connection/#{clientId}&lt;/topic&gt;
            &lt;qos&gt;1&lt;/qos&gt;
        &lt;/notification&gt;
        ...
</code></pre>
</div>
</div>

</div>
<div class="sect4">
<h5 id="bridge-config-topic-pattern">Topic Pattern Properties</h5>
<div class="paragraph">
<p>TopicPatterns are direct childs of the <a href="#bridge-config-toplevel"><code>bridge</code></a> nodes. For more information see the <a href="#bridges-remapping-of-topics">chapter about remapping of topics</a>.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>topic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The topic pattern. Can contain wildcards.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>qos</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/1/2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The quality of service level for messages which are sent and received for this topic pattern.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>direction</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">in/out/both</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures if the bridge is uni- or bidirectional.
<code>in</code> means, that this bridge will only accept messages (= subscribes on the remote broker) but never forwards messages.
<code>out</code> means that this bridge will only forward messages but will never accept messages from the remote broker (= it does not subscribe).
<code>both</code> means, that it will subscribe to messages from the remote broker and redirect messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localPrefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The topic prefix on the bridge. Must end with a slash</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remotePrefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The topic prefix on the bridge. Must end with a slash.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example Topic Pattern configuration</div>
<div class="content monospaced">
<pre class="prettyprint xml language-xml"><code>        ...
         &lt;topicPatterns&gt;
            &lt;topicPattern&gt;
                &lt;topic&gt;#&lt;/topic&gt;
                &lt;qos&gt;1&lt;/qos&gt;
                &lt;direction&gt;both&lt;/direction&gt;
                &lt;localPrefix&gt;local/&lt;/localPrefix&gt;
                &lt;remotePrefix&gt;remote/&lt;/remotePrefix&gt;
            &lt;/topicPattern&gt;
        &lt;/topicPatterns&gt;
        ...
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Complete example of a bridge.xml</div>
<div class="content monospaced">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;bridges xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:noNamespaceSchemaLocation="http://www.hivemq.com/bridges/bridge.xsd"&gt;
    &lt;bridge&gt;
        &lt;connectionName&gt;Bridge1&lt;/connectionName&gt;
        &lt;startType&gt;LAZY&lt;/startType&gt;
        &lt;addresses&gt;
            &lt;address&gt;
                &lt;host&gt;localhost&lt;/host&gt;
                &lt;port&gt;1884&lt;/port&gt;
                &lt;tls&gt;
                    &lt;protocol&gt;TLSv1.2&lt;/protocol&gt;
                    &lt;authentication&gt;true&lt;/authentication&gt;
                    &lt;keystore&gt;/home/user/keystore.jks&lt;/keystore&gt;
                    &lt;keystorePassword&gt;keystorePW&lt;/keystorePassword&gt;
                    &lt;truststore&gt;/home/user/truststore.jks&lt;/truststore&gt;
                    &lt;truststorePassword&gt;truststorePW&lt;/truststorePassword&gt;
                &lt;/tls&gt;
            &lt;/address&gt;
        &lt;/addresses&gt;
        &lt;clientId&gt;bridgeClient&lt;/clientId&gt;
        &lt;topicPatterns&gt;
            &lt;topicPattern&gt;
                &lt;topic&gt;#&lt;/topic&gt;
                &lt;qos&gt;1&lt;/qos&gt;
                &lt;direction&gt;both&lt;/direction&gt;
                &lt;localPrefix&gt;local/&lt;/localPrefix&gt;
                &lt;remotePrefix&gt;remote/&lt;/remotePrefix&gt;
            &lt;/topicPattern&gt;
        &lt;/topicPatterns&gt;
        &lt;cleanSession&gt;true&lt;/cleanSession&gt;
        &lt;idleTimeout&gt;10&lt;/idleTimeout&gt;
        &lt;notificationsEnabled&gt;true&lt;/notificationsEnabled&gt;
        &lt;notification&gt;
            &lt;topic&gt;my/broker/connection/#{clientId}&lt;/topic&gt;
            &lt;qos&gt;1&lt;/qos&gt;
        &lt;/notification&gt;
        &lt;roundRobin&gt;false&lt;/roundRobin&gt;
        &lt;tryPrivate&gt;true&lt;/tryPrivate&gt;
        &lt;restartTimeout&gt;20&lt;/restartTimeout&gt;
        &lt;threshold&gt;30&lt;/threshold&gt;
        &lt;username&gt;user&lt;/username&gt;
        &lt;password&gt;password&lt;/password&gt;
        &lt;keepAlive&gt;120&lt;/keepAlive&gt;
    &lt;/bridge&gt;
&lt;/bridges&gt;

</code></pre>
</div>
</div>

</div>
<div class="sect4">
<h5 id="bridges-xml-schema">XML Schema</h5>
<div class="paragraph">
<p>The XML Schema Definition can be found <a href="http://www.hivemq.com/bridges/bridge.xsd">online</a>. You can use your favorite XML Editor to get code completion and validation of your bridges.xml file with that Schema.</p>
</div>
<div class="paragraph">
<p>As a graphical representation, the schema looks like the following diagram.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/bridges/bridge_xsd.png" alt="Bridge XSD">
</div>
<div class="title">Figure 6. Bridge XML Schema</div>
</div>

</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_bridges_and_tls">Bridges and TLS</h4>
<div class="paragraph">
<p>HiveMQ supports encrypted communication between bridges since version <strong>2.1.0</strong>.</p>
</div>
<div class="paragraph">
<p>Bridges use the standard Java Key- and TrustStore mechanism. To learn more about that, consult the <a href="#security-chapter">Security chapter</a> of this documentation. If you are looking for a small tutorial how to generate Key- and TrustStores for HiveMQ, please see the <a href="#appendix-chapter">Appendix</a>.</p>
</div>
<div class="paragraph">
<p>A configuration example for secure bridges can be seen <a href="#bridge-config-tls">here</a>.</p>
</div>

</div>

</div>
<div class="sect2">
<h3 id="bridges-remapping-of-topics">Remapping of topics</h3>
<div class="paragraph">
<p>The concept of bridging is to forward messages to another broker. In order to do this smoothly remapping of topics is important. It is critical to understand how it works before applying it in the bridge configuration.</p>
</div>
<div class="sect3">
<h4 id="hivemqdocs_how_remapping_works">How remapping works</h4>
<div class="paragraph">
<p>In general, remapping of a topic is the forwarding of a certain local topic on the bridge broker to a remote broker, using an <code>out</code> bridge or the forwarding of a remote topic to the local bridge broker using an <code>in</code> bridge.</p>
</div>
<div class="paragraph">
<p>A remapping configuration contains a <em>topic pattern</em>, a <em>type</em>, a <em>local prefix</em> and a <em>remote prefix</em>. It is possible to specify more than one remapping for a certain bridge connection.</p>
</div>
<div class="ulist">

<ul>
<li>
<p><strong>topic pattern</strong></p>
<div class="paragraph">
<p>The topic pattern is the filter which defines what messages should be forwarded. If no local or remote prefix is specified, this behaves like a normal subscription. For example if the topic pattern is <code>#</code> (multilevel wildcard), every message is forwarded.</p>
</div>

</li>
<li>
<p><strong>type</strong></p>
<div class="paragraph">
<p>The type specifies the direction of the bridge. A bridge can have one of the types <code>out</code>, <code>in</code> and <code>both</code>. <code>out</code> means the forwarding of all messages which match the topic pattern to a remote broker. <code>in</code> means the forwarding of all messages on the bridge broker that match the topic pattern on the remote broker. <code>both</code> means that the forwarding is bi-directional.</p>
</div>

</li>
<li>
<p><strong>local prefix</strong></p>
<div class="paragraph">
<p>The local prefix is prepended the topic pattern. If the bridge is of type <code>in</code>, the remote prefix will be replaced by the local prefix.
An empty local prefix is valid.</p>
</div>

</li>
<li>
<p><strong>remote prefix</strong></p>
<div class="paragraph">
<p>The remote prefix is prepended the topic pattern. If the bridge is of type <code>out</code>, the local prefix will be replaced by the remote prefix.
An empty remote prefix is valid.</p>
</div>

</li>
</ul>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_examples">Examples</h4>
<div class="listingblock">
<div class="title">Remap /local to /remote on outgoing bridge</div>
<div class="content monospaced">
<pre class="prettyprint xml language-xml"><code>
&lt;topicPatterns&gt;
    &lt;topicPattern&gt;
        &lt;topic&gt;#&lt;/topic&gt;
        &lt;qos&gt;1&lt;/qos&gt;
        &lt;direction&gt;out&lt;/direction&gt;
        &lt;localPrefix&gt;local/&lt;/localPrefix&gt;
        &lt;remotePrefix&gt;remote/&lt;/remotePrefix&gt;
    &lt;/topicPattern&gt;
&lt;/topicPatterns&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This does the following</p>
</div>
<div class="ulist">

<ul>
<li>
<p>Every message which matches the topic <code>local/#</code> on the bridge broker is forwarded to the remote broker</p>
</li>
<li>
<p><code>local/test</code> will be forwarded to <code>remote/test</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Forward everything to topic <code>remote/</code> on an outgoing bridge</div>
<div class="content monospaced">
<pre class="prettyprint xml language-xml"><code>
&lt;topicPatterns&gt;
    &lt;topicPattern&gt;
        &lt;topic&gt;#&lt;/topic&gt;
        &lt;qos&gt;1&lt;/qos&gt;
        &lt;direction&gt;out&lt;/direction&gt;
        &lt;localPrefix&gt;&lt;/localPrefix&gt;
        &lt;remotePrefix&gt;remote/&lt;/remotePrefix&gt;
    &lt;/topicPattern&gt;
&lt;/topicPatterns&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This does the following</p>
</div>
<div class="ulist">

<ul>
<li>
<p>Every message which matches <code>#</code> on the bridge broker is forwarded to the remote broker</p>
</li>
<li>
<p>The remote prefix is added to the topic</p>
</li>
<li>
<p><code>local/test</code> will be forwarded to <code>remote/local/test</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Forward certain topics in both directions</div>
<div class="content monospaced">
<pre class="prettyprint xml language-xml"><code>
&lt;topicPatterns&gt;
    &lt;topicPattern&gt;
        &lt;topic&gt;#&lt;/topic&gt;
        &lt;qos&gt;1&lt;/qos&gt;
        &lt;direction&gt;both&lt;/direction&gt;
        &lt;localPrefix&gt;local/&lt;/localPrefix&gt;
        &lt;remotePrefix&gt;remote/&lt;/remotePrefix&gt;
    &lt;/topicPattern&gt;
&lt;/topicPatterns&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This does the following</p>
</div>
<div class="ulist">

<ul>
<li>
<p>Every message which matches <code>local/#</code> on the bridge broker is forwarded to the remote broker</p>
</li>
<li>
<p>Every message which matches <code>remote/#</code> on the remote broker is forwarded to the bridge broker</p>
</li>
<li>
<p>The <em>local prefix</em> is replace with the <em>remote prefix</em> on the remote broker</p>
</li>
<li>
<p>The <em>remote prefix</em> is replace with the <em>local prefix</em> on the bridge broker</p>
</li>
<li>
<p><code>local/test</code> will be forwarded to <code>remote/test</code></p>
</li>
<li>
<p><code>remote/test</code> will be forwarded to the bridge broker as <code>local/test</code></p>
</li>
</ul>
</div>

</div>
<div class="sect3">
<h4 id="hivemqdocs_allowed_remappings">Allowed Remappings</h4>
<div class="paragraph">
<p>When configuring remapping be careful that only valid combinations of local and remote prefixes are used. The valid and invalid combination are in the table below.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 16. Allowed Remappings</caption>
<colgroup>
<col style="width:20%;">
<col style="width:20%;">
<col style="width:20%;">
<col style="width:20%;">
<col style="width:20%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Topic</th>
<th class="tableblock halign-left valign-top">Local Prefix</th>
<th class="tableblock halign-left valign-top">Remote Prefix</th>
<th class="tableblock halign-left valign-top">Valid</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>valid</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;empty&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>valid</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;empty&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>valid</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;empty&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;empty&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>valid</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">without remapping</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;empty&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>valid</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only one topic will be remapped</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;empty&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;empty&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not valid</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;empty&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;empty&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not valid</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;empty&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;empty&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;empty&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not valid</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="hivemqdocs_loops">Loops</h4>
<div class="paragraph">
<p>Please be aware that it&#8217;s very easy to accidentally create infinite loops with the topic remapping mechanism. HiveMQ does not have a infinite loop detection implemented yet, so be very careful. Infinite Loops typically cause extreme CPU load.</p>
</div>

</div>

</div>
<div class="sect2">
<h3 id="bridge-manager-service">HiveMQ Bridge Manager Service</h3>
<div class="paragraph">
<p>This is a service in the <a href="#plugin-chapter">HiveMQ Plugin System</a>, that administer bridges. It is very powerful and can do any bridge configuration dynamically during runtime. For more information check out the <a href="http://www.hivemq.com/docs/plugins/latest/">Plugin documentation</a>.</p>
</div>

</div>
<div class="sect2">
<h3 id="bridges-interoperability">Interoperability</h3>
<div class="paragraph">
<p>For Bridging there is no official specification available and there are only a few broker implementations that support bridging. Besides HiveMQ, the Real Small Message Broker (RSMB) and Mosquitto have a functional implementation. HiveMQ is able to build bridges with both brokers and in both directions.</p>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="plugin-chapter">Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the outstanding features of HiveMQ is its ability to extend HiveMQ with virtually every functionality you can imagine. HiveMQs plugin system is highly event and callback oriented, which allows a deep integration of HiveMQ into your already existing application- and IT infrastructure.</p>
</div>
<div class="paragraph">
<div class="title">Different kind of plugins</div>
<p>There are two kinds of plugins available for HiveMQ:</p>
</div>
<div class="ulist">

<ul>
<li>
<p>Service Integration Plugins</p>
</li>
<li>
<p>Security Plugins</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong><em>Service Integration Plugins</em></strong> are plugins which aim to provide additional business functionality to HiveMQ. Examples for this kind of plugin are for example: MQTT message logging plugins, database persistence plugins, billing plugins for clients, Enterprise Service Bus (<em>ESB</em>) plugins, Complex Event Processing (<em>CEP</em>) plugins and many more.</p>
</div>
<div class="paragraph">
<p><strong><em>Security Plugins</em></strong> are plugins which enable HiveMQ to use your existing user, device and permission data models or services for <a href="#authentication-and-permissions-chapter">authentication and authorization</a>. The security plugins are the glue between your authentication and authorization data and the HiveMQ MQTT message broker. Example plugins are: database authentication &amp; authorization plugins, LDAP plugins, X.509 client certificate authentication plugins, password list plugins and many more.</p>
</div>
<div class="paragraph">
<p>A list of officially supported plugins can be found <a href="http://www.hivemq.com/plugins">here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Developing custom plugins</div>
To get started with writing plugins, you should take a look at our <a href="http://www.hivemq.com/docs/plugins/latest">official Plugin Developer Guide</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="hivemqdocs_installing_plugins">Installing Plugins</h3>
<div class="paragraph">
<p>The installation of plugins is very simple: Download the zip archive of your desired plugin and drop the contents into the HiveMQ <code>plugins</code> folder.</p>
</div>
<div class="olist arabic">
<div class="title">Instructions for installing plugins</div>
<ol class="arabic">
<li>
<p>Download a plugin from the <a href="http://www.hivemq.com/plugins">HiveMQ plugin store</a></p>
</li>
<li>
<p>Unzip the contents of your download.</p>
</li>
<li>
<p>Copy the contents of the zip file to <em>$HIVEMQ_DIRECTORY/plugins</em>.</p>
</li>
<li>
<p>Modify the properties of the plugin according to the plugins installation guide or readme file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Validating if the plugin works</div>
<p>HiveMQ will log every plugin it uses when starting up. A typical log entry with a plugin enabled looks like the <a href="#hivemq-startup-log-plugins">following listing</a></p>
</div>
<div id="hivemq-startup-log-plugins" class="listingblock">
<div class="title">Startup log with an enabled plugin</div>
<div class="content monospaced">
<pre> 21:55:48.140 [HiveMQServer STARTING] I com.dcsquare.hivemq.HiveMQServer - Starting on port 1883
 21:55:48.157 [HiveMQServer STARTING] I com.dcsquare.hivemq.HiveMQServer - Loaded Plugin Access Log Plugin - v1.0-SNAPSHOT
 21:55:48.158 [main] I com.dcsquare.hivemq.HiveMQServer - Started HiveMQ in 2051ms</pre>
</div>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_configuring_plugins">Configuring Plugins</h3>
<div class="paragraph">
<p>Every plugin comes with its own configuration file (if it needs any). Please read the installation guide or the readme which comes with every officially supported plugin.</p>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_developing_plugins">Developing Plugins</h3>
<div class="paragraph">
<p>HiveMQ can can be deeply integrated in your existing application- and IT infrastructure. For complex or unique scenarios there is often no one-size-fits-all plugin. HiveMQ gives the ability to write your own plugins for your very own integration scenarios.</p>
</div>
<div class="paragraph">
<p>The public SDK is available for free and open source on <a href="https://github.com/hivemq/hivemq-spi">Github</a>. For more information about developing HiveMQ plugins, please refer to our extensive <a href="http://www.hivemq.com/docs/plugins/latest">Plugin Documentation</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Professional plugin development</div>
<div class="paragraph">
<p>For individually developed and fully supported HiveMQ plugins which are guaranteed to scale with the HiveMQ MQTT broker, don&#8217;t hesitate to <a href="mailto:hivemq@dc-square.de">contact us</a>.
Of course, plugin development trainings are available on demand, too.</p>
</div>

</td>
</tr>
</table>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="hivemqdocs_throttling_amp_limits">Throttling &amp; Limits</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When hosting HiveMQ in environments where your resources in form of CPU, memory or bandwidth are limited it can be crucial to limit the bandwidth or the maximum TCP connections HiveMQ can accept to save resources and avoid abuse of malicious clients.</p>
</div>
<div class="paragraph">
<p>All throttling and limit properties reside in the <code>application.properties</code> file and they can be adjusted at runtime, which means you don&#8217;t have to restart HiveMQ when applying throttling parameters.</p>
</div>
<div class="sect2">
<h3 id="hivemqdocs_limiting_connections">Limiting connections</h3>
<div class="paragraph">
<p>You can apply a global connection limit to HiveMQ. That means, after a defined number of open TCP connections, HiveMQ automatically inhibits new client TCP connections. Limiting the connections can be pretty handy if your server hardware resources are limited.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 17. Relevant properties for limiting connections in the application.properties file</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.maxConnections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Maximum allowed concurrent connections. Use -1 for unlimited connections.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>By default, the <code>global.maxConnections</code> property is set to <em>-1</em>, which means HiveMQ can handle unlimited connections. <span class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnote_8" title="View footnote.">8</a>]</span>.</p>
</div>
<div class="paragraph">
<p>If you set the value of <code>global.maxConnections</code> to a lower number than the amount of currently connected clients, the currently connected clients will not be disconnected.</p>
</div>
<div class="paragraph">
<p>If you run HiveMQ in <a href="#hybrid-mode-chapter">Hybrid Mode</a>, be aware that the concurrent connections are globally for this HiveMQ instance and there is no differentiation between SSL and standard TCP connections when using a global connection limit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Connection Limits</div>
If you set a connection limit which is higher than the connection limit defined by your license, the higher limit will have no effect and the lower of the two limit will be used.
</td>
</tr>
</table>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_throttling_bandwidth">Throttling bandwidth</h3>
<div class="paragraph">
<p>You can configure HiveMQ to globally throttle the incoming and outgoing network traffic for MQTT clients if you don&#8217;t want to reserve all your bandwidth for HiveMQ or if you want to artificially slow down all clients.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Throttling message throughput</div>
A convenient way of limiting the message throughput of HiveMQ when you have many subscribers is to throttle the incoming traffic. If your system resources such as CPU and RAM are almost exhausted this is an efficient and quick way to limit the maximum incoming messages. A sane global throttling by default can prevent performance peaks.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 18. Relevant properties for limiting bandwidth in the application.properties file</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.outgoingLimit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Maximum kb/s for outgoing traffic. Use 0 if you don’t want to throttle outgoing traffic</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.ingoingLimit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Maximum kb/s for ingoing traffic. Use 0 if you don’t want to throttle ingoing traffic</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These properties reside in the <code>application.properties</code> file, which allows you to modify the values of the properties at runtime so you do not have to restart HiveMQ for enabling or disabling throttling. These values are reloaded once a minute.</p>
</div>
<div class="paragraph">
<div class="title">Throttling incoming traffic</div>
<p>To throttle incoming traffic, you can set the property <code>global.ingoingLimit</code> to a value higher than <em>0</em>. A zero value means that throttling is disabled. All values mean kilobyte per second (kb/s).</p>
</div>
<div class="paragraph">
<div class="title">Throttling outgoing traffic</div>
<p>To throttle outgoing traffic, you can set the property <code>global.outgoingLimit</code> to a value higher than <em>0</em>. A zero value means that throttling is disabled. All values mean kilobyte per second (kb/s).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Throttling individual clients</div>
With HiveMQs powerful <a href="#plugin-chapter">Plugin System</a> it is possible to throttle individual clients based on credentials, quotas or other characteristics.
</td>
</tr>
</table>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_limiting_mqtt_message_sizes">Limiting MQTT message sizes</h3>
<div class="paragraph">
<p>The MQTT protocol itself defines a MQTT <em>PUBLISH</em> payload size limit of 256MB. For a majority of the M2M scenarios this is a very high limit and most clients will probably never send a message with a payload which is that huge.</p>
</div>
<div class="paragraph">
<p>An convenient way set an upper message size limit is to use HiveMQs global message size limit which does not only restrict the MQTT <em>PUBLISH</em> payload but any message sent to the server.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 19. Relevant properties for limiting the message sizes in the application.properties file</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>global.maxMessageSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Maximum message size. The MQTT default for a message is 256MB. If clients must publish messages which are smaller, a saner message size limit should be configured.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To limit the upper size of incoming messages, set the property <code>global.maxMessageSize</code> in the <code>application.properties</code> file. The of the property is the maximum message size in bytes. 256MB is the default value to be in conformity with the MQTT specification.</p>
</div>
<div class="paragraph">
<p>If a client sends a message which is bigger than the defined value, the server will discard the message after the threshold was exceeded. It is not possible for HiveMQ to detect that a message size in bytes is higher than the defined value before that many bytes were really sent by the client.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Malicious Clients</div>
When you don&#8217;t limit the MQTT message size, it is very easy for attackers or malicious clients to steal your bandwidth and exhaust your servers memory when sending tens or hundreds of that huge messages at once for a longer period. You should strongly consider using a upper limit which suits your use case best.
</td>
</tr>
</table>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="websockets-chapter">Websockets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>HiveMQ offers <strong>native</strong> support for all major websocket versions. All major browsers support are supported. <a href="http://caniuse.com/websockets">Here is an exhaustive list</a> of all supported browsers.</p>
</div>
<div class="paragraph">
<p>When using websockets with HiveMQ, there is no need to use a separate webserver for handling the HTTP requests and the websocket upgrade, HiveMQ handles this transparently.</p>
</div>
<div class="paragraph">
<p>There is also support for <em>secure websockets</em> out of the box. Secure Websockets allow secure communication over websockets and are a great way to increase security for your application. See <a href="#secure-websockets-configuration-chapter">the secure websockets configuration chapter</a> for more information.</p>
</div>
<div class="paragraph">
<div class="title">Usage</div>
<p>Essentially websockets enable every web application to be a full-fledged MQTT client. With the usage of a <a href="#supported-mqtt-js-libraries-chapter">a supported MQTT Javascript library</a> you can deliver MQTT messages to your web application with real push or publish messages to other MQTT clients. Every websocket connection gets treated like a "normal" TCP connection and HiveMQ does not differentiate between websocket and standard TCP connections.</p>
</div>
<div class="sect2">
<h3 id="supported-mqtt-js-libraries-chapter">Supported MQTT Javascript Libraries</h3>
<div class="paragraph">
<p>In general, HiveMQ should support any MQTT 3.1 and MQTT 3.1.1 compliant Javascript library which utilizes websockets. We recommend using the <a href="http://git.eclipse.org/c/paho/org.eclipse.paho.mqtt.javascript.git/">Eclipse Paho Javascript library</a>.</p>
</div>

</div>
<div class="sect2">
<h3 id="enabling-websockets-chapter">Enabling Websockets</h3>
<div class="paragraph">
<p>Websockets are <strong>disabled</strong> by default. The following properties have to be configured properly to enable websockets:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 20. Relevant properties for enabling websockets in the configuration.properties file</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>This property enables websocket support for HiveMQ when set to <strong>true</strong></em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.ipAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The IP address on which websockets will be bound</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The port used for websockets. Defaults to <strong>8000</strong>.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.subProtocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The subprotocol used for websockets. When using Paho.js this should be mqttv3.1</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The path of the websocket</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.allowExtensions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Defines if websocket extensions are allowed.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.maxHttpChunkContentLength</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The maximum content length of a chunked HTTP request</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To enable websockets, set <code>websockets.enabled</code> to <code>true</code>. If you don&#8217;t want to use <strong>8000</strong> as the standard port for incoming HTTP requests, you can set another port via <code>websockets.port</code>.</p>
</div>
<div class="paragraph">
<p>If you are using <a href="http://git.eclipse.org/c/paho/org.eclipse.paho.mqtt.javascript.git/">Eclipse Paho</a>, you probably don&#8217;t need to change the other websocket configurations.</p>
</div>
<div class="paragraph">
<p>To change the path of the websocket, set <code>websockets.path</code> to a value you like. If you want to allow websocket extensions, set <code>websockets.allowExtensions</code> to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The subprotocol defaults to <strong>mqttv3.1</strong>. If you really want to use another websocket subprotocol than <em>mqttv3.1</em>, set <code>websockets.subProtocol</code> to any value you like. Please bear in mind that HiveMQ only implements MQTT 3.1 and MQTT 3.1.1, so things could break.</p>
</div>
<div class="paragraph">
<p>If you want to adjust the HTTP Chunk Content Length, set <code>websockets.maxHttpChunkContentLength</code> to any value in bytes you like.</p>
</div>

</div>
<div class="sect2">
<h3 id="secure-websockets-configuration-chapter">Enabling secure Websockets</h3>
<div class="paragraph">
<p>To enable secure websockets, it is important that the properties <code>keystore.location</code> and <code>keystore.password</code> are configured properly. Most properties of the <a href="#enabling-websockets-chapter">Enabling Websockets</a> chapter also apply for secure websockets.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 21. Relevant properties for enabling secure websockets in the configuration.properties file</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.secure.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>When set to <strong>true</strong>, enables secure websockets for HiveMQ</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.secure.ipAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The IP address on which secure websockets will be bound</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websockets.secure.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The port for the secure websockets.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To enable the secure websockets, set <code>websockets.secure.enabled</code> to <code>true</code>. By default, secure websockets use port <strong>8001</strong>. To use another port, set <code>websockets.secure.port</code> to a value you like.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">

You can use standard websockets and secure websockets simultaneously. Just set <code>websockets.enabled</code> and <code>websockets.secure.enabled</code> both to <code>true</code>.
</td>
</tr>
</table>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_gotchas">Gotchas</h3>
<div class="paragraph">
<p>Although a connection over websockets is not much different to standard TCP connections for HiveMQ, there are some gotchas because, most of them because of incomplete and incorrect websocket implementations in browsers which you should be aware of:</p>
</div>
<div class="ulist">

<ul>
<li>
<p>Only binary websocket frames are supported as MQTT is a binary protocol. All MQTT Javascript libraries should support Binary Websockets <span class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnote_9" title="View footnote.">9</a>]</span>.</p>
</li>
<li>
<p>If you are using <a href="#secure-websockets-configuration-chapter">Secure Websockets</a>, make sure that you don&#8217;t use a self signed certificate or that your browser accepts the certificate. In most cases you can browse directly to the Endpoint (use <em>https</em>!) and accept the certificate. Unfortunately most browsers do not support accepting untrusted certificates for websockets out of the box.</p>
</li>
<li>
<p>Client Certificate Authentication <em>*should*</em> work in theory but most browsers have severe bugs in this area at the time of writing. Although client certificate authentication is a great way to increase security, it is recommended to test thoroughly if your targeted browsers work for you.</p>
</li>
<li>
<p>If you are using secure websockets, many Chrome versions have issues with establishing the connection if you did not <em>visit</em> the resource via classic HTTP GET first. The solution for the issue can be found <a href="https://groups.google.com/forum/#!topic/hivemq/30MbEq3Xv9Q">in this support forum thread</a>.</p>
</li>
</ul>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="hivemqdocs_running_hivemq_in_the_cloud">Running HiveMQ in the Cloud</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infrastructure as a Service (<em>IaaS</em>) providers like Amazon Webservices (<em>AWS</em>) and Microsoft Windows <em>Azure</em> are excellent choices for building reliable and scalable infrastructures for your services or platforms. HiveMQ runs perfectly on any cloud infrastructure provider. This chapters covers step-by-step example configurations for popular IaaS providers. The prerequisites for every IaaS provider listed here are that you have a valid account for the desired service.</p>
</div>
<div class="sect2">
<h3 id="hivemqdocs_running_hivemq_on_amazon_webservices_aws">Running HiveMQ on Amazon Webservices (AWS)</h3>
<div class="paragraph">
<p>This will explain how to install HiveMQ on a Amazon EC2 instance. The steps may vary when using Windows as operating system.</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Navigate to <em>Instances</em> on your <em>EC2</em> Dashboard in the <a href="http://aws.amazon.com/">AWS Management Console</a>.</p>
</li>
<li>
<p>Click <em>Launch Instance</em> and start the wizard to launch a new instance. Select the <code>Ubuntu 12.04 LTS</code> AMI. <span class="footnote" id="_footnote_linuxdistributions">[<a id="_footnoteref_10" class="footnote" href="#_footnote_10" title="View footnote.">10</a>]</span></p>
</li>
<li>
<p>Follow the wizard and configure your EC2 instance.</p>
</li>
<li>
<p>Create a new <em>Security Group</em> called MQTT with a custom TCP Rule with port 1883.</p>
</li>
<li>
<p>Enable SSH Access: Create a Security Rule with a custom TCP Rule with port 22.</p>
</li>
<li>
<p>Finish the wizard to start the EC2 instance creation.</p>
</li>
<li>
<p>Now connect to your server instance via SSH.</p>
</li>
<li>
<p>Execute the following command to install all required dependencies:</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>sudo apt-get install unzip openjdk-7-jdk</code></pre>
</div>
</div>

</li>
<li>
<p>Download the latest HiveMQ version with the following command:</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>wget --content-disposition http://www.hivemq.com/downloads/releases/latest</code></pre>
</div>
</div>

</li>
<li>
<p>Unzip HiveMQ:</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>unzip hivemq-1.x.x.zip</code></pre>
</div>
</div>

</li>
<li>
<p>Start HiveMQ:</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>cd hivemq-1.x.x
./bin/run.sh</code></pre>
</div>
</div>

</li>
</ol>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_running_hivemq_on_microsoft_windows_azure">Running HiveMQ on Microsoft Windows Azure</h3>
<div class="paragraph">
<p>This will explain how to install HiveMQ on an Azure Linux VM. The steps may vary when using Windows as operating system.</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Create a new <em>Virtual Machine</em> via the Azure Web Interface. Select <code>Ubuntu 12.04 LTS</code> as Image. <span class="footnoteref">[<a class="footnote" href="#_footnote_10" title="View footnote.">10</a>]</span></p>
</li>
<li>
<p>After the Virtual Machine was created, we have to open the standard MQTT port which happens to be <strong>1883</strong>. Go to the <em>Endpoint</em> Settings of your VM in the Azure Web Interface and create a new Endpoint. Use <em>TCP</em> as protocol and set the public and private port to <strong>1883</strong>.</p>
</li>
<li>
<p>Now connect to your server instance via SSH.</p>
</li>
<li>
<p>Execute the following command to install all required dependencies:</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>sudo apt-get install unzip openjdk-7-jdk</code></pre>
</div>
</div>

</li>
<li>
<p>Download the latest HiveMQ version with the following command:</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>wget --content-disposition http://www.hivemq.com/downloads/releases/latest</code></pre>
</div>
</div>

</li>
<li>
<p>Unzip HiveMQ:</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>unzip hivemq-1.x.x.zip</code></pre>
</div>
</div>

</li>
<li>
<p>Start HiveMQ:</p>
<div class="listingblock">

<div class="content monospaced">
<pre class="prettyprint bash language-bash"><code>cd hivemq-1.x.x
./bin/run.sh</code></pre>
</div>
</div>

</li>
</ol>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="hivemqdocs_non_standard_mqtt_behaviour">Non-standard MQTT Behaviour</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes MQTT standard behaviour is not what you exactly need for your applications and scenarios. While HiveMQ implements the whole <em>MQTT 3.1</em> and <em>MQTT 3.1.1</em> specification accordingly, HiveMQ gives you full control if you want to change specific MQTT behaviour to match your use case. Before doing that, please make sure if you <strong>really</strong> want to do that, since other people who are familiar with MQTT may be confused.</p>
</div>
<div class="sect2">
<h3 id="hivemqdocs_last_will_and_testament">Last Will and Testament</h3>
<div class="paragraph">
<p>The <em>Last Will and Testament</em> (LWT) feature is very useful for giving other MQTT clients the chance to act on client disconnections. By default, LWT message are only distributed by MQTT brokers when the client didn&#8217;t do a graceful disconnect, which means sending a <em>DISCONNECT</em> MQTT message before the actual disconnection. Sometimes it may be desirable to always publish LWT messages on client disconnection, even if the client disconnected gracefully. You can specify this behaviour with the <strong>mqtt.lwt.onEveryDisconnect</strong> property.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 22. Relevant properties changing the LWT in the application.properties file</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mqtt.lwt.onEveryDisconnect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>If this feature is enabled, HiveMQ will send Last-Will-And-Testament messages on all client disconnects, even graceful disconnects with a prior DISCONNECT message.</em></p></td>
</tr>
</tbody>
</table>

</div>

</div>
</div>
<div class="sect1">
<h2 id="appendix-chapter">Appendix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="hivemqdocs_howto_configure_ssl_with_hivemq_and_keytool">Appendix A: HowTo configure SSL with HiveMQ and Keytool</h3>
<div class="ulist">

<ul>
<li>
<p>Generate the server keystore</p>
<div class="listingblock">

<div class="content monospaced">
<pre>keytool -genkey -keyalg RSA -alias HiveMQ -keystore server.jks -storepass hivemqServer -validity 360 -keysize 4096</pre>
</div>
</div>
<div class="paragraph">
<p>Enter all prompted information for the certificate and confirm with <em>yes</em>. Press <em>Enter</em> to use the same password as for the keystore.</p>
</div>

</li>
<li>
<p>Export certificate for client truststore</p>
<div class="listingblock">

<div class="content monospaced">
<pre>keytool -export -alias HiveMQ -file hivemq-server.crt -keystore server.jks</pre>
</div>
</div>
<div class="paragraph">
<p>Enter the server keystore password before the certificate can be exported</p>
</div>

</li>
<li>
<p>Generate client truststore</p>
<div class="listingblock">

<div class="content monospaced">
<pre>keytool -import -file hivemq-server.crt -alias HiveMQ -keystore client.jks</pre>
</div>
</div>
<div class="paragraph">
<p>The certificate will be shown and must be confirmed with <em>yes</em>, before the truststore is successfully created. Also there is the possibility to specify a password.</p>
</div>

</li>
<li>
<p>Place the <strong>server.jks</strong> in the <strong>HiveMQ directory</strong> and also create the following configuration and save it as <strong>configuration.properties</strong></p>
<div class="listingblock">

<div class="content monospaced">
<pre>ssl.enabled=true
keystore.location={HIVEMQ_HOME}/server.jks
keystore.password=hivemqServer</pre>
</div>
</div>

</li>
<li>
<p>Use client.jks to connect with a client</p>
</li>
</ul>
</div>

</div>
<div class="sect2">
<h3 id="hivemqdocs_howto_configure_ssl_with_hivemq_and_portecle">Appendix B: HowTo configure SSL with HiveMQ and Portecle</h3>
<div class="ulist">

<ul>
<li>
<p><strong>Download</strong> the newest version of Portecle from <a href="http://sourceforge.net/projects/portecle/">here</a> and <strong>unzip it</strong></p>
</li>
<li>
<p>Start Portecle with a double-click on the jar or <em>java -jar portecle.jar</em> in the console</p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-1.png" alt="Portecle after start">
</div>
<div class="title">Figure 7. Portecle after start</div>
</div>

</li>
<li>
<p>Firstly create the <strong>server Keystore</strong></p>
<div class="ulist">

<ul>
<li>
<p>Choose <strong>File &#8594; New Keystore</strong> from the menu and select <strong>JKS</strong> as Keystore type in the popup window</p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-2.png" alt="Choose Java Keystore">
</div>
<div class="title">Figure 8. Choose Java Keystore</div>
</div>

</li>
<li>
<p>Create a new Key Pair: <strong>Tools &#8594; Generate Key Pair</strong></p>
</li>
<li>
<p>Choose a <strong>Key Alogrithm and Key Size</strong></p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-3.png" alt="Common Key Algorithm and Size">
</div>
<div class="title">Figure 9. Common Key Algorithm and Size</div>
</div>

</li>
<li>
<p>Enter the <strong>Signature Algorithm</strong> (recommended is <em>SHA512withRSA</em>) and the <strong>Certificate Details</strong></p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-4.png" alt="Certificate Signature Algorithm and Details">
</div>
<div class="title">Figure 10. Certificate Signature Algorithm and Details</div>
</div>

</li>
<li>
<p>Choose a Key Pair Entry Alias.</p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-5.png" alt="An alias for the key pair">
</div>
<div class="title">Figure 11. An alias for the key pair</div>
</div>

</li>
<li>
<p>Set a <strong>password for the Key Pair Entry</strong></p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-7.png" alt="A password to protect the private key">
</div>
<div class="title">Figure 12. A password to protect the private key</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-8.png" alt="Successful Generation of Key Pair">
</div>
<div class="title">Figure 13. Successful Generation of Key Pair</div>
</div>

</li>
<li>
<p>Save the Keystore: <strong>File &#8594; Save Keystore As&#8230;</strong></p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-12.png" alt="Save the Keystore">
</div>
<div class="title">Figure 14. Save the Keystore</div>
</div>

</li>
<li>
<p>Export the certificate for the client: <strong>Right Click on the certificate key pair</strong> and click <strong>Export</strong></p>
</li>
<li>
<p>Select <strong>Head Certificate</strong> as Export Type and choose an <strong>export format</strong> (recommended is <em>PEM</em>)</p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-10.png" alt="Export Details">
</div>
<div class="title">Figure 15. Export Details</div>
</div>

</li>
<li>
<p><strong>Choose directory</strong> to save the certificate</p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-11.png" alt="Export Successful">
</div>
<div class="title">Figure 16. Export Successful</div>
</div>

</li>
</ul>
</div>

</li>
<li>
<p>Secondly create the client Keystore</p>
<div class="ulist">

<ul>
<li>
<p>Choose <strong>File &#8594; New Keystore</strong> from the menu and also select <strong>JKS</strong> as Keystore Type</p>
</li>
<li>
<p>Import the just saved certificate via <strong>Tools &#8594; Import Trusted Certificate</strong></p>
</li>
<li>
<p>Select the <strong>previous exported certificate</strong></p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-14.png" alt="Import server head certificate">
</div>
<div class="title">Figure 17. Import server head certificate</div>
</div>

</li>
<li>
<p><strong>Confirm the message</strong> that the trust path could not be established. This is because the certificate is self-signed and no certificate chain can verify it.</p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-15.png" alt="Warning because of the self-signed certificate">
</div>
<div class="title">Figure 18. Warning because of the self-signed certificate</div>
</div>

</li>
<li>
<p><strong>Confirm the showed certificate details</strong></p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-16.png" alt="Certificate Details">
</div>
<div class="title">Figure 19. Certificate Details</div>
</div>

</li>
<li>
<p>Trust the certificate with clicking <strong>Yes</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-16.png" alt="Accept to trust our created self-signed certificate for the server">
</div>
<div class="title">Figure 20. Accept to trust our created self-signed certificate for the server</div>
</div>

</li>
<li>
<p>Enter an alias</p>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-18.png" alt="Alias for the server certificate in the client keystore">
</div>
<div class="title">Figure 21. Alias for the server certificate in the client keystore</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/keystore-configuration/portecle-step-19.png" alt="Successful import of ther server certificate in the client keystore">
</div>
<div class="title">Figure 22. Successful import of ther server certificate in the client keystore</div>
</div>

</li>
<li>
<p>Save the Keystore as <strong>client.jks</strong> with <strong>File &#8594; Save Keystore As&#8230;</strong></p>
</li>
</ul>
</div>

</li>
<li>
<p>Place the server.jks in the HiveMQ directory and also create the following configuration and save it as configuration.properties</p>
<div class="listingblock">

<div class="content monospaced">
<pre>ssl.enabled=true
keystore.location={HIVEMQ_HOME}/server.jks
keystore.password=yourSpecifiedPassword</pre>
</div>
</div>

</li>
<li>
<p>Use client.jks to connect with a client</p>
</li>
</ul>
</div>

</div>

</div>
</div>

</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. at the time of writing, most attacks on TLS are of theoretical nature
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. Technically TLS works at OSI Layer 5 and 6. For the sake of simplicity we call it transport layer through the document
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. We strongly recommend to refresh your knowledge about private and public key cryptography if you are not sure what this means. <a href="http://en.wikipedia.org/wiki/Public-key_cryptography">This link provides useful information.</a>
</div>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. Counter statistics are Ingoing/Outgoing bytes, Ingoing/Outgoing (MQTT) messages and Ingoing/Outgoing MQTT PUBLISHES
</div>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. see <a href="http://www.hivemq.com/building-a-high-availability-mqtt-cluster/">this blog post</a>
</div>
<div class="footnote" id="_footnote_6">
<a href="#_footnoteref_6">6</a>. Technically speaking, HiveMQ will not act as a standard MQTT client but does some things differently. See <a href="#bridge-protocol">the bridge protocol section for more information</a>.
</div>
<div class="footnote" id="_footnote_7">
<a href="#_footnoteref_7">7</a>. See the <a href="#bridges-vs-clustering">Bridges vs Clustering section</a> for more information about that.
</div>
<div class="footnote" id="_footnote_8">
<a href="#_footnoteref_8">8</a>. This is only true if your license allows unlimited connections. Otherwise you are restricted to the maximum connections which is defined by your license
</div>
<div class="footnote" id="_footnote_9">
<a href="#_footnoteref_9">9</a>. It would hardly make sense to use Text Websocket Frames for a binary protocol like MQTT.
</div>
<div class="footnote" id="_footnote_10">
<a href="#_footnoteref_10">10</a>. You can of course use other Linux distributions or Windows. In this case you most likely have to use other tools than <em>apt-get</em> to install the dependencies like <em>Java</em>.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1-DRAFT<br>
Last updated 2015-04-16 17:47:35 CEST
</div>
</div>
</body>
</html>